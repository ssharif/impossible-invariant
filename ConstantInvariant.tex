\documentclass{amsart}
\usepackage{amsmath, amsthm, amssymb,latexsym,enumerate,mathrsfs}
\usepackage[all]{xy}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{invariant}
\usepackage{xcolor}
\usepackage{tikz-cd}

\title{Algebraic invariants constant on unpolarized isomorphism classes of abelian varieties}

%\author[E.\ Rains]{E.\ Rains}
%\address{}
%\email{}
%\author[?]{?}
%\address{}
%\email{}
%\author[A.\ Silverberg]{A.\ Silverberg}
%\address{Department of Mathematics, University of California, Irvine, CA 92697, USA}
%\email{asilverb@uci.edu}
%\subjclass[2010]{??}
%\keywords{abelian varieties}
%\thanks{Support for the research was provided by the Alfred P.~Sloan Foundation
%and the National Science Foundation.}

\begin{document}

\maketitle

\section{Introduction}
\label{sec:introduction}

Let $\ag$ be the moduli space of principally polarized abelian varieties. If $A, B$ are abelian varieties, we say $A$ and $B$ are \emph{weakly isomorphic}, written $A \approx B$, if they are isomorphic as unpolarized abelian varieties. Our goal is to show the following.
\begin{theorem}\label{thm:invariant-c-constant}
  Suppose $f: \ag \to X$ be a morphism of schemes over $\C$. If $f(A) = f(B)$ whenever $A \approx B$, then $f$ is constant.
\end{theorem}
We will also show that the theorem holds when $\C$ is replaced by either $\Q$ or $\Z$. We will deduce the theorem as a corollary of another result, stated below.

Let $R$ be a scheme, and for an $R$-scheme $S$ write $S[R]$ to be the set
\[
  \dlim_{T/R} S(T)
\]
where the union is over all $R$-schemes $T$. Let
\[
  \sg: \rschemes \to \mathcal{P}((\ag \times \ag)[R])
\]
be the functor from $R$-schemes to the power set of $(\ag \times \ag)[R]$ which, for $T$ an $R$-scheme, gives the set
\[
  \sg(T) = \{(A,B) \in (\ag \times \ag)(T) | A \approx B\}.
\]
Then we will show the following.
\begin{theorem}\label{thm:sg-c-dense}
  $\sg(\C)$ is Zariski dense in $\ag \times \ag$.
\end{theorem}

\paragraph{Overview.}

The idea is as follows. Choose a prime $\ell$. For $n$ an integer, we will construct maps $X_0(\ell^n) \to \ag$. For each such map, the image of a point $(E, \phi)$ will be an abelian variety isogenous to $E^g$. As $n$ and the choice of maps vary, we obtain a sequence of curves $X_i \subset \ag$. We will show that
\begin{enumerate}
    \item\label{i:curves-dense} $\overline{\cup X_i} = \ag$ and
    \item\label{i:Sg-dense} for all $i,j$, $\overline{S_g \cap (X_i \times X_j)} = X_i \times X_j$.
\end{enumerate}
Here, the bar denotes Zariski closure. From these two properties, Theorem~\ref{thm:sg-c-dense} will follow. To obtain Theorem~\ref{thm:invariant-c-constant}, construct the fiber product
\[
  \xymatrix{
    \df \ar[r] \ar[d] & \ag \ar[d]^f \\
    \ag \ar[r]^f & X.
  }
\]
There is a natural map $\df \to \ag \times \ag$. The hypotheses on $f$ will imply that, viewed as functors, the latter map factors through $\sg$. Since the functor $\sg$ is ``dense'' in the sense of Theorem~\ref{thm:sg-c-dense}, we will have $\df = \ag \times \ag$, whence the claim follows.


\section{Constructing curves on $\ag$}
\label{sec:curves-on-Ag}

Fix a prime $\ell$ and positive integer $n$\textcolor{red}{TODO: what constraints are required for $n$?}. In this section we will construct a sequence of maps $X_0(\ell^n) \to \ag$ whose images $X_i$ are curves in $\ag$. These curves will be used in the steps outlined in Section~\ref{sec:introduction}.

We will describe the maps $X_0(\ell^n) \to \ag$ in two ways: one based on the moduli interpretation, and one based on complex analysis. The fact that these two interpretations are the same is key to the proof of Theorem~\ref{thm:sg-c-dense}. We will apply the moduli interpretation to prove step~\ref{i:Sg-dense}, and the complex analysis version to prove step~\ref{i:curves-dense}. \textcolor{red}{TODO: explain that the latter does not carry to characteristic $p$}

\subsection{Geometric description}
\label{sec:geo-desc}

For any vector $\vec{n} = (n_1,\dots,n_g)$ with $1 \leq n_1 \leq \cdots \leq n_g \leq n$, and any generic polarization $\lambda$\textcolor{red}{TODO: explain why choosing $\lambda$ is equivalent to choosing a matrix}, we construct a map $\psi_{\vec{n},\lambda}: X_0(\ell^n) \to \ag$ as follows. Given an elliptic curve $E$ and a cyclic $\ell^n$-isogeny $\varphi$, we can uniquely decompose $\varphi$ as a sequence of $\ell$-isogenies
\[
  E = E_0 \xrightarrow{\ell} E_1 \cdots E_{n-1} \xrightarrow{\ell} E_n.
\]
We take $\psi_{\vec{n},\lambda}(E,\varphi)$ to be the abelian variety $E_{n_1} \times \cdots \times E_{n_g}$ with the principal polarization determined by $\lambda$, i.e.
\begin{equation}\label{def:psi-n-lambda}
  \psi_{\vec{n},\lambda}(E,\varphi) = (E_{n_1} \times \cdots \times E_{n_g}, \lambda).
\end{equation}

\subsection{Analytic description}
\label{sec:ana-desc}

For any symmetric, positive definite matrix $A \in M_{g \times g}(\Z[1/\ell])$ with $\det A = \ell^m$ for some $m$, we define a map $\psi_A: \hh \to \hh_g$\textcolor{red}{TODO: make sure Siegel spaces have been defined} as follows.
\[
  \psi_A(\tau) = \tau A
\]
There is a natural map $\Gamma_0(\ell^n) \to \Sp_{2g}(\Z)$ given by ???\textcolor{red}{TODO: describe map}
Therefore $\psi_A$ descends to a map
\begin{equation}\label{def:psi-A-n}
  \psi_{A,n}: \hh/\Gamma_0(N) \to \hh_g/\Sp_{2g}(\Z).
\end{equation}
Thus $\psi_{A,n}$ induces a map $X_0(\ell^n) \to \ag$, which we also denote by $\psi_{A,n}$.

\subsection{Equivalence of descriptions}

\textcolor{red}{TODO: explain why $\psi_{\vec{n},\lambda}$ and $\psi_{A,n}$ are really the same map}

\newpage

\section{Step 1}
\label{sec:step-1}

In this section, we focus on Step~\ref{i:curves-dense} outlined in Section~\ref{sec:introduction}. That is, we aim to prove that
\[
  \bigcup_{A} \im\left(\psi_{A,n}\right) \text{ is Zariski dense in } \ag,
\]
where $A$ ranges over all symmetric positive definite matrices whose determinent is a power of $\ell$. Recall that $\ell$ and $n$ are fixed.\textcolor{red}{TODO: reference where fixing of $\ell$ and $n$ occurs}

We will actually show the slightly stronger claim that $\cup_{A} \psi_{A,n}(i\R)$ is holomorphically dense. That is, if any holomorphic function $f$ on $\ag$ vanishes on $\cup_{A} \psi_{A,n}(i\R)$, then $f$ vanishes everywhere.

For a ring $R$, let $\Sympd_g(R)$ denote the set of symmetric positive definite matrices in $\Sl_g(R)$. Recall that for any $A \in \Sympd_g(\Z[1/\ell])$, the map $\psi_{A,n}$ is induced from the map $\psi_A: \hh \to \hh_g$ given by $\tau \mapsto \tau A$. Therefore
\[
  \bigcup_{A \in \Sympd_g(\Z[1/\ell])} \psi_A(i\R) = i\R\Sympd_g\left(\Z\left[\frac{1}{\ell}\right]\right).
\]

\begin{lemma}
  $\Sympd_g\left(\Z\left[\frac{1}{\ell}\right]\right)$ is holomorphically dense in $\Sympd_g(\R)$.
\end{lemma}
\begin{proof}
  \textcolor{red}{TODO}
\end{proof}

\begin{lemma}
  $i\R\Sympd_g(\R)$ is holomorphically dense in $\hh_g$.
\end{lemma}
\begin{proof}
  \textcolor{red}{TODO}
\end{proof}

It follows that the image of the $\psi_{A,n}$ is dense in $\ag$.\textcolor{red}{TODO: check this and make it a cor. or something}

\section{Step 2}
\label{sec:step-2}

In this section, we focus on Step~\ref{i:Sg-dense} outlined in Section~\ref{sec:introduction}. That is, we aim to prove that
\[
  \zclos{S_g \cap (X_i \times X_j)} = X_i \times X_j.
\]
Here $X_i$ and $X_j$ are images of two maps of the form $\psi_{\vec{n},\lambda}$ from Section~\ref{sec:geo-desc} (see Equation~\ref{def:psi-A-n}).

We will prove the claim using the following lemma.

\begin{lemma}\label{lem:lim-degree}
  Let $\psi = \psi_{\vec{n},\lambda}$ and $\psi' = \psi_{\vec{n}',\lambda'}$ be two of the maps $X_0(\ell^n) \to \ag$ defined as in Equation~\ref{def:psi-A-n}. Then there exists a sequence $x_i \in X_0(\ell^n)$ such that
  \[
    \lim_{i \to \infty}\#\left\{ y \in X_0(\ell^n) \colon \text{ $\psi(x_i)$ and $\psi'(y)$ are weakly isomorphic} \right\} = \infty.
  \]
\end{lemma}

Before we prove Lemma~\ref{lem:lim-degree}, we will show how to finish the argument.

\begin{corollary}
  Let $\psi$ and $\psi'$ be as in Lemma~\ref{lem:lim-degree}, and let $X$ and $X'$ be their images in $\ag$. Then
  \[
    \zclos{S_g \cap (X \times X')} = X \times X'.
  \]
\end{corollary}
\begin{proof}
  By Lemma~\ref{lem:lim-degree}, the left hand side has infinite number of points \textcolor{red}{TODO: do we need to know what ``kind'' of points?}. This implies that $\dim \zclos{S_g \cap (X \times X')} \geq 1$. Consider the projection $\pi_X: \zclos{S_g \cap (X \times X')} \to X$. Lemma~\ref{lem:lim-degree} says that this map has unbounded degree. Therefore $\dim \zclos{S_g \cap (X \times X')} \geq 2$.\textcolor{red}{TODO: deal with possible vertical components}
\end{proof}

We now return to the proof of Lemma~\ref{lem:lim-degree}.

\begin{proof}[Proof of Lemma~\ref{lem:lim-degree}]
  Choose a quadratic imaginary field $K$, principal prime $\varphi\sO_K$ over $\ell$, and rational primes $c_i$ as in Lemma~\ref{lem:K-exists} below. Let $E$ be an elliptic curve with CM by $\sO_K$.\textcolor{red}{TODO: where does $E$ live? Can do over $\C$ or $\overline{\fp}$}

  Let $\sC$ denote a cyclic subgroup of $E$ with order prime to $\ell$. Then the set of subgroups $\sC_i, \varphi(\sC), \dots, \varphi^n(\sC)$ give a set of $\ell$-isogenies from $E$. Note that $\varphi$ induces a map $E/\varphi^j(\sC) \to E/\varphi^{j+1}(\sC)$ \textcolor{red}{TODO: should we describe the kernel?}. Thus we have the following diagram
  \[
    \begin{tikzcd}
      \sC \arrow[d,"\varphi"] \arrow[r] & E \arrow[d,"\varphi"] \arrow[r] & E/\sC \arrow[d]
      \\
      \varphi(\sC) \arrow[d,"\varphi"] \arrow[r] & E \arrow[d,"\varphi"] \arrow[r] & E/\varphi(\sC) \arrow[d]
      \\
      \vdots \arrow[d,"\varphi"] & \vdots \arrow[d,"\varphi"] & \vdots \arrow[d]
      \\
      \varphi^n(\sC) \arrow[r] & E \arrow[r] & E/\varphi^{n}(\sC).
    \end{tikzcd}
  \]
  Let $\varphi^{\ast}(\sC)$ denote the composition $E/\sC \to \cdots \to E/\varphi^n(\sC)$. This is an $\ell^n$-isogeny, so the pair $(E/\sC,\varphi^{\ast}(\sC))$ defines a point in $X_0(\ell^n)$.

  For each $i$, we fix a cyclic subgroup $\sC_i$ of $E$ with order $c_i$. We will define $x_1 = (E/\sC_1,\varphi^{\ast}(\sC_1))$. Before defining $x_2,x_3,\dots$, we will first describe a set of $y$ such that $\psi(x_1) = \psi'(y)$.

  Recall from Section~\ref{sec:geo-desc} the description of $\psi = \psi_{\vec{n},\lambda}$. Because we have the decomposition of $\varphi^{\ast}(\sC_1)$ into a sequence of $\ell$-isogenies, the geometric description allows us to evaluate
  \[
    \psi(E/\sC_1,\varphi^{\ast}(\sC_1)) = (E/\varphi^{n_1}(\sC_1) \times \cdots \times E/\varphi^{n_g}(\sC_1),\lambda).
  \]
  The set of $c_1$-torsion subgroups of $E$ is a $\F_{c_1^2}^\times/\F_{c_1}^\times$ torser. This follows from the fact that $E[c_1] \cong \sO_K/c_1\sO_K \cong \F_{c_1^2}$ as $\sO_K$-modules \textcolor{red}{TODO: cite somewhere for this?}. Recall from our construction of the $c_i$, that $\varphi \mod{c_i\sO_K}$ is a $g$th power. So we can find some $\gamma \in \F_{c_1^2}^\times$ such that $\varphi \equiv \gamma^g \mod{c_1\sO_K}$. In particular, $\varphi(\sC_1) = \gamma^g(\sC_1)$.

  The set of $y$ we will construct will be of the form $\psi'(E/\beta\sC_1,\varphi^{\ast}(\beta\sC_1))$ for some $\beta \in \F_{c_1^2}^\times/\F_{c_1}^\times$. We need to ensure that $\psi(x_i) \cong \psi'(y)$ as unpolarized abelian varieties. This means that we need to find $\beta$ such that
  \[
    E/(\gamma^g)^{n_1}(\sC_1) \times \cdots \times E/(\gamma^g)^{n_g}(\sC_1)
    \cong
    E/(\gamma^g)^{n_1'}(\beta\sC_1) \times \cdots \times E/(\gamma^g)^{n_g'}(\beta\sC_1).
  \]
  By Lemma~???\textcolor{red}{TODO: state prove this lemma, key fact: $\Sl_g(\sO_K) \to \Sl_g(\sO_K/c\sO_K)$ surjective?}, this holds if and only if
  \[
    (\gamma^{n_1 + \cdots + n_g})^g = \beta^g(\gamma^{n_1' + \cdots n_g'})^g.
  \]
  The hypothesis on the $c_i$ implies that $g$ divides $\#(\F_{c_i^2}^\times/\F_{c_i}^\times) = c_i + 1$, so there are $g$ solutions $\beta \in \F_{c_i^2}^\times/\F_{c_i}^\times$ to this equation.\footnote{Note that these solutions are not the solutions in $\F_{c_i^2}$ reduced mod $\F_{c_i}$. For example, $\beta^4 = 1$ has $4$ solutions in $\F_9$, but modulo $\F_3^\times$ these give only $2$ distinct solutions. On the other hand, $\beta^4 = 1$ has $4$ distinct solutions in $\F_9/\F_3$, namely $1+i$ and $(1+i)^3$, because $1+i$ is a generator for $\F_9^\times$ as a cyclic group.} This gives us $g$ points $y \in X_0(\ell^n)$ with $\psi(x_1) = \psi'(y)$.

  For $x_2$, we repeat much of the same construction except that instead of using $\sC_2$, we use $\sC_1\sC_2$ and liberally apply the Chinese remainder theorem. The set of subgroups of $E$ with order $c_1c_2$ is a torser over $(\F_{c_1^2}^\times/\F_{c_1}^\times) \times (\F_{c_2^2}^\times/\F_{c_2}^\times)$. Then we are searching for $\beta \in \sO_K/c_1c_2\sO_K$ such that
  \[
    E/\varphi^{n_1}(\sC_1\sC_2) \times \cdots \times E/\varphi^{n_g}(\sC_1\sC_2)
    \cong
    E/\varphi^{n_1'}(\beta\sC_1\sC_2) \times \cdots \times E/\varphi^{n_g'}(\beta\sC_1\sC_2).
  \]
  Again this reduces to counting the number of solutions $\beta$ to an equation of the form $(\gamma^{g})^{n_1 + \cdots + n_g} = \beta^g(\gamma^g)^{n_1' + \cdots n_g'}$, except that this equation is modulo $c_1c_2\sO_K$. So by a similar argument, this gives $g^2$ points $y \in X_0(\ell^n)$ such that $\psi(x_2) = \psi'(y)$.

  Continuing in the same fashion shows that for each $x_i$, there are $g^i$ points $y \in X_0(\ell_n)$ such that $\psi(x_i) = \psi'(y)$.
\end{proof}

\begin{lemma}\label{lem:K-exists}
  Let $g$ be a positive integer and $\ell$ a prime. Then there exists a quadratic imaginary field $K$ such that
  \begin{enumerate}
    \item $\ell$ splits in $K$ into principal primes $\alpha\sO_K \cdot \overline{\alpha}\sO_K$
    \item There is an infinite number of rational primes $c$ such that
    \begin{enumerate}
      \item $c$ is inert in $K$
      \item $c \equiv -1 \mod{g}$
      \item $\alpha \mod c\sO_K \in \sO_K/c\sO_K$ is a $g$th power.
    \end{enumerate}
  \end{enumerate}
\end{lemma}
\begin{proof}
    Let $\zeta_g$ be a primitive $g$th root of unity. Choose any quadratic imaginary field $K$ such that $\ell$ splits into principal ideals generated by $\alpha$, and $\Q(\zeta_g) \cap K = \Q$. Let $L = K(\zeta_g,\alpha^{1/g},\overline{\alpha}^{1/g})$.

  Consider the tower of field extensions
  \[
  \begin{tikzcd}
    &
    L
    \arrow[d,-]
    \\
    &
    K(\zeta_g)
    \arrow[dl,-] \arrow[dr,-]
    \\
    \Q(\zeta_g)
    \arrow[dr,-]
    &&
    K
    \arrow[dl,-]
    \\
    &
    \Q
  \end{tikzcd}
  \]

  Let $\frak{c}$ be a prime of $L$ lying over a prime $c$ of $\Q$. Let $\sigma = \mathrm{Frob}(\frak{c})$. Note that $c$ is inert in $K$ if and only if $\sigma|_K$ is complex conjugation. Similarly, $c \equiv -1 \mod{g}$ if and only if $\sigma|_{\Q(\zeta_g)}$ is complex conjugation.
%To see this, note that under the usual isomorphism $\Gal(\Q(\zeta_g)/\Q) \cong (\Z/g\Z)^\times$, complex conjugation is associated to $-1$. The map Frobenius element corresponding to $\frak{c} \cap \Q(\zeta_g)$ sends $\zeta_g \mapsto \zeta_g^c$.
Finally, if $\sigma$ has order $2$, then $\sO_L/\frak{c} \cong \sO_K/c\sO_K \cong \F_{c^2}$. In particular, $\alpha^{1/g}$ is a $g$th root of $\alpha$ in $\F_{c^2}$.

  Note that if $\sigma$ has order $2$ and restricts to complex conjugation in $K$ and $\Q(\zeta_g)$, then so does any element in $\Gal(L/\Q)$. So by Chebotarev's density theorem, it remains to show there exists an element with these properties.

  The Galois group $\Gal(L/\Q)$ is isomorphic to $(\Z/g\Z \times \Z/g\Z) \rtimes ((\Z/g\Z)^\times \times \Z/2\Z)$ \textcolor{red}{TODO: explain why}. Then the element $\sigma = ((0,0),(-1,-1))$ has the required property. Note that every conjugate also works. \textcolor{red}{TODO: is there an easier way to get existence without computing the full Galois group?}
\end{proof}

\begin{lemma}
  Let $E$ be an elliptic curve with CM by $\sO_K$ for some imaginary quadratic field $K$ such that $\sO_K^\times = \{\pm 1\}$. Let $c$ be a prime not equal to the characteristic of the base field. Then the set of $c$-torsion subgroups of $E$ form a $(\sO_K/c\sO_K)^\times/(\Z/c\Z)^\times$ torsor. Moreover, if $\sC$ is a $c$-torsion subgroup and $\alpha_1,\beta_1,\dots,\beta_d,\alpha_d \in (\sO_K/c\sO_K)^\times/(\Z/c\Z)^\times$, then
  \[
    \prod E/\alpha_i(\sC)
    \cong
    \prod E/\beta_i(\sC)
    \quad\Leftrightarrow\quad
    \prod \alpha_i = \prod \beta_i.
  \]
  Here the left isomorphism is as unpolarized abelian varieties.
\end{lemma}
\begin{proof}
  The first claim follows from the fact that $E[c] \cong \sO_K/c\sO_K$ as an $\sO_K$-module.\textcolor{red}{TODO: more details}.

  It remains to prove the second claim. We start with the case of $d = 2$. Consider the matrix $\overline{\gamma} \in \begin{bmatrix} \alpha_1^{-1} & 0 \\ 0 & \alpha_1 \end{bmatrix} \in \Sl_2{\sO_K/c\sO_K}$. By Lemma~\ref{lem:quot-surj-SL2}, $\overline{\gamma}$ lifts to some $\gamma \in \Sl_2{\sO_K}$. This corresponds to an automorphism of $E \times E$ sending $\alpha_1(\sC) \times \alpha_2(\sC)$ to $\sC \times \alpha_1\alpha_2(\sC)$. Therefore we have\textcolor{red}{TODO: emphasize that all isomorphisms are as unpolarized AV}
  \[
    E/\alpha_1(\sC) \times E/\alpha_2(\sC)
    \cong
    E/\beta_1(\sC) \times E/\beta_2(\sC)
  \]
  if and only if
  \[
    E/\sC \times E/\alpha_1\alpha_2(\sC)
    \cong
    E/\sC \times E/\beta_1\beta_2(\sC).
  \]

  \textcolor{red}{TODO: somehow cancel out the copy of E on the left}

  It remains to show that $E/\alpha_1\alpha_2(\sC) \cong E/\beta_1\beta_2(\sC)$ if and only if $\alpha_1\alpha_2 = \beta_1\beta_2$. By the hypothesis on $\sO_K^\times \cong \Aut E$, we know that $E/\sC_1 \cong E/\sC_2$ if and only if $\sC_1 = \sC_2$ for any finite subgroups $\sC_1,\sC_2$ of $E$. That is, because $\Aut E$ is trivial, distinct subgroups have distinct quotients. Therefore $E/\alpha_1\alpha_2(\sC) \cong E/\beta_1\beta_2(\sC)$ if and only if $\alpha_1\alpha_2(\sC) = \beta_1\beta_2(\sC)$ if and only if $\alpha_1\alpha_2 = \beta_1\beta_2$ because $c$-torsion subgroups form a torsor over $(\sO_K/c\sO_K)^\times/(\Z/c\Z)^\times$.

  \textcolor{red}{TODO: finish the $d > 2$ case}
\end{proof}


\begin{lemma}\label{lem:quot-surj-SL2}
  Let $R$ be a Dedekind domain and $\alpha \in R$. Then the natural map $\Sl_2(R) \to \Sl_2(R/\alpha R)$ is surjective.
\end{lemma}
\begin{proof}
  % See Thm.~3.2 https://kconrad.math.uconn.edu/blurbs/grouptheory/SL(2,Z).pdf
  % Diamond and Shurman exercise 1.2.2b
  This proof follows\textcolor{red}{TODO: cite Diamond and Shurman Ex~1.2.2b}

  \textcolor{red}{TODO: is this true if we replace $\alpha$ with an arbitrary ideal $I$?}

  We will assume that $\alpha \neq 0$ as otherwise the claim is trivial.

  Let $\begin{bmatrix} \overline{a} & \overline{b} \\ \overline{c} & \overline{d} \end{bmatrix} \in \Sl_2(R/\alpha R)$ and choose any lift $\begin{bmatrix} a & b \\ c & d \end{bmatrix} \in \mathrm{M}_2(R)$ with $c \neq 0$.

  First we claim that $(c) + (d) + (\alpha) = R$. This follows from the fact that $(a)d + (-b)c = 1 + (e)\alpha$ for some $e \in R$.

  Next we claim that we can replace $d$ with $d' \in R$ such that $d' \equiv d \mod{\alpha}$, and $(c) + (d') = R$. It is sufficient to find $x \in R$ such that $d + \alpha x \not\equiv 0 \mod{\frak{p}}$ over all primes $\frak{p} \mid (c)$ (here we are using that $c \neq 0$). Note that this equation always has at least one solution except possibly when $\alpha \equiv 0 \mod{\frak{p}}$. But then $d \not\equiv 0 \mod{\frak{p}}$ by the previous claim. Therefore by the Chinese remainder theorem, we can find a solution $k \in R$ such that $d + k\alpha \not\equiv 0 \mod{\frak{p}}$ for all $\frak{p} \mid c$.

  Now we will finish the proof. By the previous claim, we can find $s,t \in R$ such that $sd' - tc = 1$.  By hypothesis, $ad' - bc = 1 + m\alpha$ for some $m \in R$. Then set $a' = a - mt\alpha$ and $b' = b - mt\alpha$. Then
  \[
    (a - ms\alpha)d' - (b - mt\alpha)c
    =
    ad' - bc - m\alpha(sd' - tc)
    =
    1 + m\alpha - m\alpha
    =
    1.
  \]
\end{proof}



\section{Matrix density results}
\label{sec:matr-dens-results}

\begin{lemma}
  $\tclos{\Sl_g(\Z[1/\ell])} = \Sl_g(\R)$.
\end{lemma}

\begin{definition}
  For $\ell$ a prime, let $\detl$ be the set of $g \times g$ symmetric, positive definite integer matrices $N$ for which $\det N$ is a power of $\ell$.
\end{definition}

\begin{lemma}
  If $G \in \Sl_g(\Z[1/\ell])$, then for some $n \in \N$,
  \[
    \ell^n GG^t \in \detl.
  \]
\end{lemma}

\begin{definition}
  Let $\permat$ be the set of $g \times g$ real, positive definite symmetric matrices  with determinant $1$.
\end{definition}

\begin{lemma}
  $\permat = \{GG^t | G \in \Sl_g(\R)\}$.
\end{lemma}

\begin{proposition}
  $\tclos{\{A/(\det A)^{\frac{1}{g}} | g \in \detl\}} = \permat$.
\end{proposition}

\begin{lemma}
  $\hclos{\{ irM | M \in \permat, r > 0\}} = \hh_g$.
\end{lemma}

\begin{lemma}
  \[
    \hclos{\bigcup_{N \in \detl} \psi_N(i\R)} = \hh_g.
  \]
\end{lemma}

\begin{lemma}
  \[
    \hclos{\bigcup_{N \in \detl} \im \psi_N} = \hh_g.
  \]
\end{lemma}

\begin{proposition}
  \[
    \zclos{\bigcup_{N \in \detl} \im \psinmod} = \ag.
  \]
\end{proposition}
\end{document}
