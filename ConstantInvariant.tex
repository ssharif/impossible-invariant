\documentclass{amsart}
\usepackage{amsmath, amsthm, amssymb,latexsym,enumerate,mathrsfs}
\usepackage[all]{xy}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{invariant}
\usepackage{xcolor}
\usepackage{tikz-cd}
\usepackage{lineno}
\linenumbers

\title[Invariants constant on unpolarized isomorphism classes]{Algebraic invariants constant on unpolarized isomorphism classes of abelian varieties}

%\author[E.\ Rains]{E.\ Rains}
%\address{}
%\email{}
%\author[?]{?}
%\address{}
%\email{}
%\author[A.\ Silverberg]{A.\ Silverberg}
%\address{Department of Mathematics, University of California, Irvine, CA 92697, USA}
%\email{asilverb@uci.edu}
%\subjclass[2010]{??}
%\keywords{abelian varieties}
%\thanks{Support for the research was provided by the Alfred P.~Sloan Foundation
%and the National Science Foundation.}

\begin{document}

\maketitle

\section{Introduction}
\label{sec:introduction}

Let $\ag$ be the moduli space of principally polarized abelian varieties. If $A, B$ are abelian varieties, we say $A$ and $B$ are \emph{weakly isomorphic}, written $A \approx B$, if they are isomorphic as unpolarized abelian varieties. Our goal is to show the following.
\begin{theorem}\label{thm:invariant-c-constant}
  Suppose $f: \ag \to X$ be a morphism of schemes over $\C$. If $f(A) = f(B)$ whenever $A \approx B$, then $f$ is constant.
\end{theorem}
We will also show that the theorem holds when $\C$ is replaced by either $\Q$ or $\Z$. We will deduce the theorem as a corollary of another result, stated below.

Let $R$ be a scheme, and for an $R$-scheme $S$ write $S[R]$ to be the set
\[
  \dlim_{T/R} S(T)
\]
where the union is over all $R$-schemes $T$. Let
\[
  \sg: \rschemes \to \mathcal{P}((\ag \times \ag)[R])
\]
be the functor from $R$-schemes to the power set of $(\ag \times \ag)[R]$ which, for $T$ an $R$-scheme, gives the set
\[
  \sg(T) = \{(A,B) \in (\ag \times \ag)(T) | A \approx B\}.
\]
Then we will show the following.
\begin{theorem}\label{thm:sg-c-dense}
  $\sg(\C)$ is Zariski dense in $\ag \times \ag$.
\end{theorem}

\paragraph{Overview.}

The idea is as follows. Choose a prime $\ell$. For $n$ an integer, we will construct maps $X_0(\ell^n) \to \ag$. For each such map, the image of a point $(E, \phi)$ will be an abelian variety isogenous to $E^g$. As $n$ and the choice of maps vary, we obtain a sequence of curves $X_i \subset \ag$. We will show that
\begin{enumerate}
    \item\label{i:curves-dense} $\overline{\cup X_i} = \ag$ and
    \item\label{i:Sg-dense} for all $i,j$, $\overline{S_g \cap (X_i \times X_j)} = X_i \times X_j$.
\end{enumerate}
Here, the bar denotes Zariski closure. From these two properties, Theorem~\ref{thm:sg-c-dense} will follow. To obtain Theorem~\ref{thm:invariant-c-constant}, construct the fiber product
\[
  \xymatrix{
    \df \ar[r] \ar[d] & \ag \ar[d]^f \\
    \ag \ar[r]^f & X.
  }
\]
There is a natural map $\df \to \ag \times \ag$. The hypotheses on $f$ will imply that, viewed as functors, the latter map factors through $\sg$. Since the functor $\sg$ is ``dense'' in the sense of Theorem~\ref{thm:sg-c-dense}, we will have $\df = \ag \times \ag$, whence the claim follows.


\section{Constructing curves on $\ag$}
\label{sec:curves-on-Ag}

Fix a prime $\ell$ and positive integer $n$\textcolor{red}{TODO: what constraints are required for $n$?}. In this section we will construct a sequence of maps $X_0(\ell^n) \to \ag$ whose images $X_i$ are curves in $\ag$. These curves will be used in the steps outlined in Section~\ref{sec:introduction}.

We will describe the maps $X_0(\ell^n) \to \ag$ in two ways: one based on the moduli interpretation, and one based on complex analysis. The fact that these two interpretations are the same is key to the proof of Theorem~\ref{thm:sg-c-dense}. We will apply the moduli interpretation to prove step~\ref{i:Sg-dense}, and the complex analysis version to prove step~\ref{i:curves-dense}. \textcolor{red}{TODO: explain that the latter does not carry to characteristic $p$}

\subsection{Geometric description}
\label{sec:geo-desc}

For any vector $\vec{n} = (n_1,\dots,n_g)$ with $1 \leq n_1 \leq \cdots \leq n_g \leq n$, and any generic polarization $\lambda$\textcolor{red}{TODO: explain why choosing $\lambda$ is equivalent to choosing a matrix}, we construct a map $\psi_{\vec{n},\lambda}: X_0(\ell^n) \to \ag$ as follows. Given an elliptic curve $E$ and a cyclic $\ell^n$-isogeny $\varphi$, we can uniquely decompose $\varphi$ as a sequence of $\ell$-isogenies
\[
  E = E_0 \xrightarrow{\ell} E_1 \cdots E_{n-1} \xrightarrow{\ell} E_n.
\]
We take $\psi_{\vec{n},\lambda}(E,\varphi)$ to be the abelian variety $E_{n_1} \times \cdots \times E_{n_g}$ with the principal polarization determined by $\lambda$, i.e.
\begin{equation}\label{def:psi-n-lambda}
  \psi_{\vec{n},\lambda}(E,\varphi) = (E_{n_1} \times \cdots \times E_{n_g}, \lambda).
\end{equation}

\subsection{Analytic description}
\label{sec:ana-desc}

Suppose that $A \in M_{g \times g}$ is symmetric, positive definite, and has non-zero determinant $\det A = N$. Then there is map $\psi_A: \hh \to \hh_g$ given by
\[
  \psi_A(\tau) = \tau A.
\]
This descends to a map
\begin{equation}\label{def:psi-A-n}
  \hh/\Gamma_0(N) \to \hh_g/\Sp_{2g}(\Z).
\end{equation}
which gives a map $X_0(N) \to \ag$, which we also denote by $\psi_{A}$.

To see this, let $\sigma = \begin{bmatrix} a & b \\ c & d \end{bmatrix} \in \Gamma_0(N)$ and let $\tau \in \hh$. A direct computation shows that the matrix $M = \begin{bmatrix} aI & bA \\ cA^{-1} & dI \end{bmatrix}$ lies in $\Sp_{2g}(\Z)$
% it is integral because \det(A) | c, so cA^{-1} is integral.
% M is in Sp because then M^t*\Omega*M = M
% where \Omega = \begin{matrix} 0 & I \\ -I & 0 \end{matrix}
and that
\[
  \sigma(\tau)A
  =
  \frac{a\tau + b}{c\tau + d} A
  =
  \left(a(\tau A) + bI\right)\left(cA^{-1}(\tau A) + dI\right)^{-1}
  =
  M(\tau A).
\]

\textcolor{red}{TODO: is it ok to remove the $n$ subscript we had before?}

\textcolor{red}{TODO: is the following lemma necessary at all?}
The following shows that the image of $\psi_A$ in $\ag$ is weakly isomorphic to $\psi_{UAV}$ for any $U,V \in \Gl_g(\Z)$.

\begin{lemma}\label{lem:A-UAV-weakly-isom}
  Let $A$ be as above. If $U,V \in \Gl_g(\Z)$, then $\psi_{A}(\tau)$ is weakly isomorphic to $\psi_{UAV}(\tau)$ for all $\tau \in \hh$.
\end{lemma}
\begin{proof}
  We need to show that the lattices spanned by the columns of $\begin{bmatrix} I & A\tau \end{bmatrix}$ and $\begin{bmatrix} I & UAV\tau \end{bmatrix}$ are isomorphic. Note that the column span of $\begin{bmatrix} I & A\tau \end{bmatrix}$ is the same as that of the product
  \[
    \begin{bmatrix} U^{-1} & A\tau \end{bmatrix}\begin{bmatrix} I & 0 \\ 0 & V \end{bmatrix}
    =
    \begin{bmatrix} U^{-1} & AV\tau \end{bmatrix}.
  \]
  Multiplication on the left by $U$ gives an isomorphism between this lattice and $\begin{bmatrix} I & UAV\tau \end{bmatrix}$.
\end{proof}



\subsection{Equivalence of descriptions}

Write $\Omega$ for $\tau I$, where $I$ is the $g \times g$ identity matrix. The period matrix for $\psi_{I,n}(\tau)$ is
\[
  M = \begin{bmatrix}
    I | \Omega
  \end{bmatrix}.
\]
Observe that if $E$ is the elliptic curve corresponding to $\tau \in \hh$, then the abelian variety corresponding to $\psi_{I,n}(\tau) \in \hh_g$ is $E^g$ with the product polarization.

Given a period matrix $M$, let $\Lambda(M)$ be the lattice generated by the columns of $M$, so that the corresponding abelian variety is $A(M) := \C^g/\Lambda(M)$. We say two period matrices $M, M'$ are \emph{equivalent} if $\C^g/\Lambda(M)$ is isomorphic to $\C^g/\Lambda(M')$, and similarly the matrices are \emph{weakly equivalent} if the abelian varieties are weakly isomorphic. Let $D$ be the Smith normal form of $A$, so that there are $U,V \in \Gl_g(\Z)$ for which $A = UDV$. Then the period matrix for $\Psi_{A,n}(\tau)$ is
\[
  \begin{bmatrix}
    I | \Omega A
  \end{bmatrix},
\]
which is equivalent to
\[
  \begin{bmatrix}
    D^{-1}U^{-1} | V
  \end{bmatrix}
\]
and hence weakly equivalent to
\[
M' = \begin{bmatrix}
    D^{-1}U^{-1} | \Omega
  \end{bmatrix}.
\]
Let $M''$ be the period matrix\[
  \begin{bmatrix}
    D^{-1} | \Omega
  \end{bmatrix}.
\]
The matrix $D^{-1}$ is a diagonal matrix whose diagonal entries are powers of $1/\ell$. Suppose the $i$th diagonal entry is $1/\ell^{n_i}$, and set
\[
  \vec{n} = (n_1, \ldots, n_g).
\]
One sees that $A(M'') = \psivec(\tau)$, where $\lambda$ is the product polarization. In particular, if $P \in E$ generates the distinguished $\ell^n$-torsion subgroup, then
\[
  A(M'') = E/\langle \ell^{n-n_1} P \rangle \times \cdots \times E/\langle \ell^{n-n_g} P \rangle.
\]
The abelian variety $A(M')$ is similary a quotient of $E^g$ by an $\ell$-power subgroup. But the natural map $U: E^g \to E^g$ sends one kernel subgroup to another, and thus induces a (weak) isomorphism $A(M') \to A(M'')$. As $A(M'') = \psivec(\tau)$ and $A(M')$ is weakly isomorphic to $A(M) = \psimat(\tau)$, we conclude that
\[
\psimat(\tau) \textrm{ and } \psivec(\tau)
\]
are weakly isomorphic.

\newpage

\section{Step 1}
\label{sec:step-1}

In this section, we focus on Step~\ref{i:curves-dense} outlined in Section~\ref{sec:introduction}. That is, we aim to prove that
\[
  \bigcup_{A} \im\left(\psi_{A,n}\right) \text{ is Zariski dense in } \ag,
\]
where $A$ ranges over all symmetric positive definite integer matrices whose determinant is a power of $\ell$. Recall that $\ell$ is fixed.\textcolor{red}{TODO: reference where fixing of $\ell$ occurs}

We will actually show the slightly stronger claim that $\cup_{A} \psi_{A,n}(i\R)$ is holomorphically dense, where $A$ ranges over ???. That is, if any holomorphic function $f$ on $\ag$ vanishes on $\cup_{A} \psi_{A,n}(i\R)$, then $f$ vanishes everywhere.

For a ring $R$, let $\Sympd_g(R)$ denote the set of symmetric positive definite matrices in $\Sl_g(R)$. Recall that for any $A \in \Sympd_g(\Z[1/\ell])$, the map $\psi_{A,n}$ is induced from the map $\psi_A: \hh \to \hh_g$ given by $\tau \mapsto \tau A$. Therefore
\[
  \bigcup_{A \in \Sympd_g(\Z[1/\ell])} \psi_A(i\R) = i\R\Sympd_g\left(\Z\left[\frac{1}{\ell}\right]\right).
\]

\begin{lemma}
  $\Sympd_g\left(\Z\left[\frac{1}{\ell}\right]\right)$ is holomorphically dense in $\Sympd_g(\R)$.
\end{lemma}
\begin{proof}
  \textcolor{red}{TODO}
\end{proof}

\begin{lemma}
  $i\R\Sympd_g(\R)$ is holomorphically dense in $\hh_g$.
\end{lemma}
\begin{proof}
  \textcolor{red}{TODO}
\end{proof}

It follows that the image of the $\psi_{A,n}$ is dense in $\ag$.\textcolor{red}{TODO: check this and make it a cor. or something}

\section{Step 2}
\label{sec:step-2}

In this section, we focus on Step~\ref{i:Sg-dense} outlined in Section~\ref{sec:introduction}. That is, we aim to prove that
\[
  \zclos{S_g \cap (X_i \times X_j)} = X_i \times X_j.
\]
Here $X_i$ and $X_j$ are images of two maps of the form $\psi_{\vec{n},\lambda}$ from Section~\ref{sec:geo-desc} (see Equation~\ref{def:psi-A-n}).

We will prove the claim using the following lemma.

\begin{lemma}\label{lem:lim-degree}
  Let $\psi = \psi_{\vec{n},\lambda}$ and $\psi' = \psi_{\vec{n}',\lambda'}$ be two of the maps $X_0(\ell^n) \to \ag$ defined as in Equation~\ref{def:psi-A-n}. Then there exists a sequence $x_i \in X_0(\ell^n)$ such that
  \[
    \lim_{i \to \infty}\#\left\{ y \in X_0(\ell^n) \colon \text{ $\psi(x_i)$ and $\psi'(y)$ are weakly isomorphic} \right\} = \infty.
  \]
\end{lemma}

Before we prove Lemma~\ref{lem:lim-degree}, we will show how to finish the argument.

\begin{corollary}
  Let $\psi$ and $\psi'$ be as in Lemma~\ref{lem:lim-degree}, and let $X$ and $X'$ be their images in $\ag$. Then
  \[
    \zclos{S_g \cap (X \times X')} = X \times X'.
  \]
\end{corollary}
\begin{proof}
  By Lemma~\ref{lem:lim-degree}, the left hand side has infinite number of points \textcolor{red}{TODO: do we need to know what ``kind'' of points?}. This implies that $\dim \zclos{S_g \cap (X \times X')} \geq 1$. Consider the projection $\pi_X: \zclos{S_g \cap (X \times X')} \to X$. Lemma~\ref{lem:lim-degree} says that this map has unbounded degree. Therefore $\dim \zclos{S_g \cap (X \times X')} \geq 2$.\textcolor{red}{TODO: deal with possible vertical components}
\end{proof}

We now return to the proof of Lemma~\ref{lem:lim-degree}.

\begin{proof}[Proof of Lemma~\ref{lem:lim-degree}]
  Choose a quadratic imaginary field $K$, principal prime $\varphi\sO_K$ over $\ell$, and rational primes $c_i$ as in Lemma~\ref{lem:K-exists} below. Let $E$ be an elliptic curve with CM by $\sO_K$.\textcolor{red}{TODO: where does $E$ live? Can do over $\C$ or $\overline{\fp}$}

  Let $\sC$ denote a cyclic subgroup of $E$ with order prime to $\ell$. Then the set of subgroups $\sC_i, \varphi(\sC), \dots, \varphi^n(\sC)$ give a set of $\ell$-isogenies from $E$. Note that $\varphi$ induces a map $E/\varphi^j(\sC) \to E/\varphi^{j+1}(\sC)$ \textcolor{red}{TODO: should we describe the kernel?}. Thus we have the following diagram
  \[
    \begin{tikzcd}
      \sC \arrow[d,"\varphi"] \arrow[r] & E \arrow[d,"\varphi"] \arrow[r] & E/\sC \arrow[d]
      \\
      \varphi(\sC) \arrow[d,"\varphi"] \arrow[r] & E \arrow[d,"\varphi"] \arrow[r] & E/\varphi(\sC) \arrow[d]
      \\
      \vdots \arrow[d,"\varphi"] & \vdots \arrow[d,"\varphi"] & \vdots \arrow[d]
      \\
      \varphi^n(\sC) \arrow[r] & E \arrow[r] & E/\varphi^{n}(\sC).
    \end{tikzcd}
  \]
  Let $\varphi^{\ast}(\sC)$ denote the composition $E/\sC \to \cdots \to E/\varphi^n(\sC)$. This is an $\ell^n$-isogeny, so the pair $(E/\sC,\varphi^{\ast}(\sC))$ defines a point in $X_0(\ell^n)$.

  For each $i$, we fix a cyclic subgroup $\sC_i$ of $E$ with order $c_i$. We will define $x_1 = (E/\sC_1,\varphi^{\ast}(\sC_1))$. Before defining $x_2,x_3,\dots$, we will first describe a set of $y$ such that $\psi(x_1) = \psi'(y)$.

  Recall from Section~\ref{sec:geo-desc} the description of $\psi = \psi_{\vec{n},\lambda}$. Because we have the decomposition of $\varphi^{\ast}(\sC_1)$ into a sequence of $\ell$-isogenies, the geometric description allows us to evaluate
  \[
    \psi(E/\sC_1,\varphi^{\ast}(\sC_1)) = (E/\varphi^{n_1}(\sC_1) \times \cdots \times E/\varphi^{n_g}(\sC_1),\lambda).
  \]
  The set of $c_1$-torsion subgroups of $E$ is a $\F_{c_1^2}^\times/\F_{c_1}^\times$ torser. This follows from the fact that $E[c_1] \cong \sO_K/c_1\sO_K \cong \F_{c_1^2}$ as $\sO_K$-modules, see see Lemma~\ref{c-subgps-torsor}. Recall from our construction of the $c_i$, that $\varphi \mod{c_i\sO_K}$ is a $g$th power. So we can find some $\gamma \in \F_{c_1^2}^\times$ such that $\varphi \equiv \gamma^g \mod{c_1\sO_K}$. In particular, $\varphi(\sC_1) = \gamma^g(\sC_1)$.

  The set of $y$ we will construct will be of the form $\psi'(E/\beta\sC_1,\varphi^{\ast}(\beta\sC_1))$ for some $\beta \in \F_{c_1^2}^\times/\F_{c_1}^\times$. We need to ensure that $\psi(x_i) \cong \psi'(y)$ as unpolarized abelian varieties. This means that we need to find $\beta$ such that
  \[
    E/(\gamma^g)^{n_1}(\sC_1) \times \cdots \times E/(\gamma^g)^{n_g}(\sC_1)
    \cong
    E/(\gamma^g)^{n_1'}(\beta\sC_1) \times \cdots \times E/(\gamma^g)^{n_g'}(\beta\sC_1).
  \]
  By Lemma~\ref{c-subgps-torsor}, this holds if and only if
  \[
    (\gamma^{n_1 + \cdots + n_g})^g = \beta^g(\gamma^{n_1' + \cdots n_g'})^g.
  \]
  The hypothesis on the $c_i$ implies that $g$ divides $\#(\F_{c_i^2}^\times/\F_{c_i}^\times) = c_i + 1$, so there are $g$ solutions $\beta \in \F_{c_i^2}^\times/\F_{c_i}^\times$ to this equation.\footnote{Note that these solutions are not the solutions in $\F_{c_i^2}$ reduced mod $\F_{c_i}$. For example, $\beta^4 = 1$ has $4$ solutions in $\F_9$, but modulo $\F_3^\times$ these give only $2$ distinct solutions. On the other hand, $\beta^4 = 1$ has $4$ distinct solutions in $\F_9/\F_3$, namely $1+i$ and $(1+i)^3$, because $1+i$ is a generator for $\F_9^\times$ as a cyclic group.} This gives us $g$ points $y \in X_0(\ell^n)$ with $\psi(x_1) = \psi'(y)$.

  For $x_2$, we repeat much of the same construction except that instead of using $\sC_2$, we use $\sC_1\sC_2$ and liberally apply the Chinese remainder theorem. The set of subgroups of $E$ with order $c_1c_2$ is a torser over $(\F_{c_1^2}^\times/\F_{c_1}^\times) \times (\F_{c_2^2}^\times/\F_{c_2}^\times)$. Then we are searching for $\beta \in \sO_K/c_1c_2\sO_K$ such that
  \[
    E/\varphi^{n_1}(\sC_1\sC_2) \times \cdots \times E/\varphi^{n_g}(\sC_1\sC_2)
    \cong
    E/\varphi^{n_1'}(\beta\sC_1\sC_2) \times \cdots \times E/\varphi^{n_g'}(\beta\sC_1\sC_2).
  \]
  Again this reduces to counting the number of solutions $\beta$ to an equation of the form $(\gamma^{g})^{n_1 + \cdots + n_g} = \beta^g(\gamma^g)^{n_1' + \cdots n_g'}$, except that this equation is modulo $c_1c_2\sO_K$. So by a similar argument, this gives $g^2$ points $y \in X_0(\ell^n)$ such that $\psi(x_2) = \psi'(y)$.

  Continuing in the same fashion shows that for each $x_i$, there are $g^i$ points $y \in X_0(\ell_n)$ such that $\psi(x_i) = \psi'(y)$.
\end{proof}

\begin{lemma}\label{lem:K-exists}
  Let $g$ be a positive integer and $\ell$ a prime. Then there exists a quadratic imaginary field $K$ such that
  \begin{enumerate}
    \item $\ell$ splits in $K$ into principal primes $\alpha\sO_K \cdot \overline{\alpha}\sO_K$
    \item There is an infinite number of rational primes $c$ such that
    \begin{enumerate}
      \item $c$ is inert in $K$
      \item $c \equiv -1 \mod{g}$
      \item $\alpha \mod c\sO_K \in \sO_K/c\sO_K$ is a $g$th power.
    \end{enumerate}
  \end{enumerate}
\end{lemma}
\begin{proof}
    Let $\zeta_g$ be a primitive $g$th root of unity. Choose any quadratic imaginary field $K$ such that $\ell$ splits into principal ideals generated by $\alpha$, and $\Q(\zeta_g) \cap K = \Q$. To see that such a field $K$ exists, note that $K = \Q(\sqrt{1-\ell})$ is a quadratic imaginary field and $1 + \sqrt{1 - \ell} \in K$ has norm $\ell$. Let $L = K(\zeta_g,\alpha^{1/g},\overline{\alpha}^{1/g})$.

  %The fields can be visualized in the following tower.
  %\[
  %\begin{tikzcd}
  %  &
  %  L
  %  \arrow[d,-]
  %  \\
  %  &
  %  K(\zeta_g)
  %  \arrow[dl,-] \arrow[dr,-]
  %  \\
  %  \Q(\zeta_g)
  %  \arrow[dr,-]
  %  &&
  %  K
  %  \arrow[dl,-]
  %  \\
  %  &
  %  \Q
  %\end{tikzcd}
  %\]

  Let $\frak{c}$ be a prime of $L$ lying over a prime $c$ of $\Q$. Let $\sigma = \mathrm{Frob}(\frak{c}) \in \Gal(L/\Q)$. Note that $c$ is inert in $K$ if and only if $\sigma|_K$ is complex conjugation. Similarly, $c \equiv -1 \mod{g}$ if and only if $\sigma|_{\Q(\zeta_g)}$ is complex conjugation.
%To see this, note that under the usual isomorphism $\Gal(\Q(\zeta_g)/\Q) \cong (\Z/g\Z)^\times$, complex conjugation is associated to $-1$. The map Frobenius element corresponding to $\frak{c} \cap \Q(\zeta_g)$ sends $\zeta_g \mapsto \zeta_g^c$.
Finally, if $\sigma$ has order $2$, then $\sO_L/\frak{c} \cong \sO_K/c\sO_K \cong \F_{c^2}$. In particular, $\alpha^{1/g}$ is a $g$th root of $\alpha$ in $\F_{c^2}$. Moreover, if $\sigma$ satisfies these conditions, then so does any conjugate of $\sigma$. So by Chebotarev's density theorem, it remains to show there exists some $\sigma \in \Gal(L/\Q)$ such that $\sigma$ has order $2$ and restricts to complex multiplication in $K$ and $\Q(\zeta_g)$.

  Choose any embedding $\iota: L \to \C$ and define $\sigma \in \Gal(L/\Q)$ by $a \mapsto \iota^{-1}(\overline{\iota(a)})$. Note that $\sigma$ has order $2$. Because $K$ and $\Q(\zeta_g)$ are CM fields, $\sigma$ restricts to the usual complex conjugation on them. Therefore $\sigma$ has the desired properties.
  %The Galois group $\Gal(L/\Q)$ is isomorphic to $(\Z/g\Z \times \Z/g\Z) \rtimes ((\Z/g\Z)^\times \times \Z/2\Z)$ \textcolor{red}{TODO: explain why}. Then the element $\sigma = ((0,0),(-1,-1))$ has the required property. Note that every conjugate also works.
\end{proof}

\begin{lemma}\label{c-subgps-torsor}
  Let $E$ be an ordinary elliptic curve with CM by $\sO_K$ for some imaginary quadratic field $K$ such that $\sO_K^\times = \{\pm 1\}$. Let $c$ be a prime not equal to the characteristic of the base field. Then the set of $c$-torsion subgroups of $E$ form a $(\sO_K/c\sO_K)^\times/(\Z/c\Z)^\times$ torsor. Moreover, if $\sC$ is a $c$-torsion subgroup and $\alpha_i, \beta_i \in (\sO_K/c\sO_K)^\times/(\Z/c\Z)^\times$ for $1 \leq i \leq d$, then
  \[
    \prod E/\alpha_i(\sC)
    \cong
    \prod E/\beta_i(\sC)
    \quad\Leftrightarrow\quad
    \prod \alpha_i = \prod \beta_i.
  \]
  Here the isomorphism on the left is as unpolarized abelian varieties.
\end{lemma}
\begin{proof}
  To prove the first claim, we will show that $E[c] \cong \sO_K/c\sO_K$ as an $\sO_K$-module. To see this, note that if the base field is $\C$, then $E \cong \C/I$ for some ideal $I$ of $\sO_K$. Since $\C/I \cong \C/J$ for any $J$ in the same ideal class as $I$, we may assume $I$ is coprime to $c$. Then $E[c] \cong \frac{1}{c}I/I \cong I/cI \cong \sO_K/c\sO_K$ as $\sO_K$ modules. If the base field is $\overline{\F}_p$, then we can find a model of $E$ over a finite field $\F_q$ with $E[c] \subseteq E(\F_q)$. By \cite[Thm.~1]{complex1996lenstra}, $E(\F_q) \cong \End_{\F_q}(E) / (\pi - 1)$ as $\End_{\F_q}(E)$ modules. Here $\pi$ is the $q$th power Frobenius. As $E$ is ordinary, $\End_{\F_q}(E) \cong \sO_K$. Moreover, $E[c] \subseteq E(\F_q)$ implies that $c \mid \Nm(\pi - 1) \Rightarrow c\sO_K \supseteq (\pi - 1)$. Hence $E[c] \cong (\sO_K/(\pi - 1))/(c\sO_K/(\pi - 1)) \cong \sO_K/((c) + (\pi - 1)) \cong \sO_K/c\sO_K$.

  For the second claim, we will make use of the results in \cite{kani2011products} summarized in Section~\ref{sec:kani}. See that section for some of the notation used here\textcolor{red}{TODO: dont do this}. First we note that for any $c$-torsion subgroup, $\End(E/\sC) \cong \sO := \Z + c\sO_K$ by Lemma~\ref{lem:ker-idl-end}. In what follows, we fix a lift $\alpha$ of each class in $(\sO_K/c\sO_K)^\times/(\Z/c\Z)^\times$.  Each such $\alpha$ induces an isogeny $\tilde{\alpha}: E/\sC \to E/\alpha(\sC)$. As the endomorphism rings of these curves are the same, Lemma~\ref{lem:prod-idls} shows that
  \[
    \prod E/\alpha_i(\sC) \cong \prod E/\beta_i(\sC)
  \]
  if and only if
  \[
    \prod I(\tilde{\alpha}_i) \cong \prod I(\tilde{\beta}_i).
  \]
  \textcolor{red}{TODO: $I(\tilde{\alpha}_i)$ is probably $\alpha\sO_K \cap \sO$? And these products are prob isomorphic if and only if there are elements of $\sO$ that we can multiply to get the same thing. These elements prob give an equivalence in $(\sO_K/c\sO_K)^\times/(\Z/c\Z)^\times$?}

  %For the second claim, consider the diagonal matrix $\overline{\gamma} \in \Sl_d(\sO_K/c\sO_K)$ with diagonal entries $\alpha_1^{-1},\dots,\alpha_{d-1}^{-1},(\alpha_1\cdots\alpha_{d-1})$. By \cite[Cor.~5.2, Pg.~18]{ktheory1964bass}, we can find a lift $\gamma \in \Sl_d(\sO_K)$. This corresponds to an automorphism of $E^d$ sending $\prod \alpha_i(\sC)$ to $\sC \times \cdots \times \sC \times \left(\prod \alpha_i\right)(\sC)$.\textcolor{red}{TODO: this may be unnecessary}.
\end{proof}

\subsection{Kernel ideals and ideal subgroups}\label{sec:kani}

\begin{definition}[{\cite[Sec.~2]{kani2011products}}]
  Let $A$ be an abelian variety over a field $K$. Given a regular left-ideal $I$ of $\End A$, let $H(I) = \cap_{\phi \in I}\ker \phi$. A finite subgroup scheme $H$ is a \emph{ideal subgroup} if $H = H(I)$ for some $I$. Symmetrically, given such an $H$, let $I(H) = \{\phi \in \End A \colon H \subseteq \ker\phi\}$. We say $I$ is a \emph{kernel ideal} if it is the form $I(H)$ for some $H$.
\end{definition}

\begin{theorem}[{\cite[Thm.~46]{kani2011products}}]
  Suppose $A$ is an abelian variety over a field $K$. If $H_1,\dots,H_n$ and $H_1',\dots,H_n'$ are ideal subgroups of $A$, then
  \[
    A/H_1 \times \cdots \times A/H_n
    \cong
    A/H_1' \times \cdots A/H_n'
  \]
  if and only if
  \[
    I(H_1) \oplus \cdots \oplus I(H_n)
    \cong
    I(H_1') \oplus \cdots \oplus I(H_n').
  \]
  The isomorphism below is as $M_n(\End A)$-modules.
\end{theorem}

In the special case where $A = E$ is an elliptic curve and $\End E$ is an order $\sO$ in a quadratic imaginary field, then this last condition holds if and only if $\prod I(H_i) \cong \prod I(H_i')$ as ideals in $\sO$, see \cite[Rem.~49]{kani2011products}. Moreover, if $\varphi: E \to E'$ is an isogeny, then $\ker\varphi$ is an ideal subgroup if and only if the order $\sO' \cong \End E'$ contains $E$. A special case of this is the following.

\begin{lemma}\label{lem:prod-idls}
  Let $E$ be an elliptic curve over a field $K$ such that $\End E$ is isomorphic to an order $\sO$ in an imaginary quadratic field. Suppose that $\varphi_i: E \to E_i$ and $\varphi_i': E \to E_i'$ for $1 \leq i \leq d$ are isogenies with $\End E_i \cong \End E_i' \cong \sO$. Then
  \[
    \prod E_i
    \cong
    \prod E_i'
    \quad\text{if and only if}\quad
    \prod I(\ker\varphi_i)
    \cong
    \prod I(\ker\varphi_i').
  \]
\end{lemma}

\begin{lemma}\label{lem:ker-idl-end}
  Let $K$ be any algebraically closed field, and let $E/K$ be an elliptic curve such that $\End E$ is isomorphic to an order $\sO$ in a quadratic imaginary field $K$. Suppose that $c$ is a prime avoiding the index $[\sO_K : \sO]$ and is inert in $K$. If $\varphi: E \to E'$ is a $c$-isogeny, then $\End E' \cong \Z + c\sO$. In particular, $\ker\varphi$ is an ideal subgroup.
\end{lemma}
\begin{proof}
  Note $\End E'$ is isomorphic to an order $\sO'$ in $K$. Conjugation by $\varphi$ and its dual shows that $\Z + c^2\sO \subseteq \sO' \subseteq \sO$\textcolor{red}{TODO: this is spelled out in \cite[Prop.~21]{kohel1996endomorphisms} for finite fields, but the arguments holds in general}. This shows one of $\sO$,$\sO'$ has index $c$ in the other, or they are equal.

  By hypothesis, $\sO$ has no ideal of norm $c$. Hence $\ker\varphi$ is not an ideal subgroup. So by Lemma~\ref{lem:ker-idl}, $\sO' \subsetneq \sO$. Then by above, we have that that $[\sO : \sO'] = c$.
\end{proof}


\section{Matrix density results}
\label{sec:matr-dens-results}

\begin{lemma}\label{lemma:sl-z-1overl-dense-sl-r}
  $\tclos{\Sl_g(\Z[1/\ell])} = \Sl_g(\R)$.
\end{lemma}

\begin{proof}
  Let $G \in \Sl_g(\R)$. Factor $G$ as a product of elementary matrices
  \[
    G = E_n \cdots E_2 E_1
  \]
  where $\det E_i = \pm 1$. Observe that, with at most one exception, the entries of each $E_i$ are $0$ or $\pm 1$. Thus we can find a $g \times g$ matrix $E_i'$ with entries in $\Z[1/\ell]$ and $\det E_i' = \det E_i$ which is arbitrarily close to $E_i$. Let $G' = E_n' \cdots E_1'$. Certainly $G' \in \Sl_g(\Z[1/\ell])$. Since matrix multiplication is continuous, $G'$ is close to $G$.
\end{proof}

\begin{proof}[Alternative proof]
  Let $G = [g_{ij}] \in \Sl_g(\R)$. Let $X = [x_{ij}]$ be a matrix of $g^2$ variables, and consider the determinant map $\det: \R[\{x_{ij}\}] \to \R$. Choose $r,s$ so that
  \[
    \frac{\partial \det}{\partial x_{rs}}(G) \neq 0.
  \]
  Since $\Z[1/\ell]$ is dense in $\R$, for $(i,j) \neq (r,s)$ we can find $a_{ij} \in \Z[1/\ell]$ which is arbitrarily close to $g_{ij}$. By our hypotheses on $(r,s)$, there exists $a_{rs} \in \R$ such that $\det [a_{ij}] = 1$. Clearly $a_{rs} \in \Z[1/\ell]$. The determinant is continuous, so $a_{rs}$ must also be close to $g_{rs}$.
\end{proof}

% \begin{proof}
%   The group scheme $\Sl_g$ is a connected reductive group, and hence is unirational. (???cite) Since $\Z[1/\ell]$ is topologically dense in $\R$, the claim follows.

%   Details: unirational means there is a dominant rational map $f:\Pro^n \to \Sl_g$ for some $n$. Given $G \in \Sl_g(\R)$, there some $G' \in f(\Pro^n(\R))$ which is close to $G$. Let $P \in \Pro^n(\R)$ with $f(P) = G'$. Then 
% \end{proof}

\begin{definition}
  For $\ell$ a prime, let $\detl$ be the set of $g \times g$ symmetric, positive definite integer matrices $N$ for which $\det N$ is a power of $\ell$.
\end{definition}

\begin{lemma}\label{lemma:ggt-spd-detl}
  If $G \in \Sl_g(\Z[1/\ell])$, then for all sufficiently large $n \in \N$,
  \[
    \ell^n GG^t \in \detl.
  \]
\end{lemma}

\begin{proof}
  Certainly for all $n$, $\ell^n GG^t$ will be symmetric, positive definite, and have determinant which is an integer power of $\ell$. Choose $N$ to be the maximum power of $\ell$ appearing in the denominators of the entries of $GG^t$. Then for $n \geq N$, $\ell^n GG^t$ is an integer matrix.
\end{proof}


\begin{definition}
  Let $\permat$ be the set of $g \times g$ real, positive definite symmetric matrices  with determinant $1$.
\end{definition}

\begin{lemma}\label{lemma:ggt-periodmatrices}
  $\permat = \{GG^t | G \in \Sl_g(\R)\}$.
\end{lemma}

\begin{proof}
  Suppose $A \in \permat$. By the Spectral Theorem, there exist a real orthogonal matrix $O$ and a real diagonal matrix $D$ such that $A = ODO^t$. Let $D$ have diagonal entries $d_1, d_2, \dots, d_n$. Since $A$ is positive definite, $d_i > 0$ for all $i$. Furthermore, $\prod d_i = \det A = 1$. Let
  \[
    G = O
    \begin{bmatrix}
      \sqrt{d_1} & & & \\
      & \sqrt{d_2} & & \\
      & & \ddots & \\
      & & & \sqrt{d_{g}} 
    \end{bmatrix}.
\]
Then $A = GG^t$ and $G \in \Sl_g(\R)$.
\end{proof}

\begin{proposition}\label{prop:A-over-detA}
  $\tclos{\{A/(\det A)^{\frac{1}{g}} | A \in \detl\}} = \permat$.
\end{proposition}

\begin{proof}
  In the set
  \[
    \{A/(\det A)^{\frac{1}{g}} | A \in \detl\},
  \]
  by Lemma~\ref{lemma:ggt-spd-detl}, we may replace $A$ with $\ell^n GG^t$ with $G \in \Sl_g(Z[1/\ell])$, $n$ sufficiently large (depending on $G$). But $\det (\ell^n GG^t) = \ell^n$, so the above set equals
  \[
    \{GG^t | G \in \Sl_g(\Z[1/\ell])\}.
  \]
  The claim follows from combining Lemmas~\ref{lemma:sl-z-1overl-dense-sl-r} and \ref{lemma:ggt-periodmatrices}.
\end{proof}

Let $\R^+$ denote the set of positive real numbers.
\begin{lemma}\label{lemma:holomorphic-closure-irM}
  $\hclos{\{ irM | M \in \permat, r \in \R^+\}} = \hh_g$.
\end{lemma}

\begin{proof}
  This is a standard result in multivariable complex analysis, which we are all completely familiar with.
\end{proof}

\begin{lemma}
  \[
    \hclos{\bigcup_{A \in \detl} \psi_A(i\R^+)} = \hh_g.
  \]
\end{lemma}

\begin{proof}
  Observe that if $X$ is a subset of a complex manifold, then $\tclos{X} \subset \hclos{X}$. Now
  \begin{align*}
    \cup \psi_A(i\R^+) &= \cup \{irA | r \in \R^+, A \in \detl\} \\
               &= \cup \{irA/(\det A)^{\frac{1}{g}} | r \in \R^+, A \in \det l\}.
  \end{align*}
  By Proposition~\ref{prop:A-over-detA}, the topological closure of the above set is
  \[
    \{irM | r \in \R^+, M \in \permat\}.
  \]
  The result now follows from Lemma~\ref{lemma:holomorphic-closure-irM}.
\end{proof}

\begin{lemma}
  \[
    \hclos{\bigcup_{A \in \detl} \im \psi_A} = \hh_g.
  \]
\end{lemma}

\begin{proof}
  Since $\psi_A(i\R^+) \subset \im \psi_A$, the claim follows from the previous lemma.
\end{proof}

\begin{proposition}
  \[
    \zclos{\bigcup_{A \in \detl} \im \psinmod} = \ag.
  \]
\end{proposition}

\begin{proof}
  By definition of $\psinmod$, the $\im \psinmod \subset \ag$ is the image of $\im \psi_A \subset \hh_g$ under the canonical covering map $\hh_g \to \ag$. As we have shown, $\im \psi_A$ is holomorphically dense in $\hh_g$, and so its image in $\ag$ is holomorphically dense when viewing $\ag$ as a complex manifold. But holomorphically dense implies Zariski dense.
\end{proof}

\section{Characteristic $p$}
\label{sec:characteristic-p}

We will show $\cup \im \psivec$ is dense in $\ao^g$. Choose a sequence of elliptic curves $(E_i)$ over $\fpbar$ as follows. Fix an ordinary curve $E_0$ with a cyclic $\ell$-isogeny $E_0 \to E_1$ so that the endomorphism rings are different. Repeat with $E_i$\textcolor{red}{Travis: I think we want to avoid going back, so we could say the endomorphism ring is strictly smaller}. Then $\overline{\{E_i\}} = \ao$, and hence
\[
  \overline{\{E_{i_1} \times \cdots \times E_{i_g}\}} = \ao^g.
\]
Furthermore, each element in the left-hand set above is in the image of $\psivec$ for some $\vec{n}$.

\bibliographystyle{alpha}
\bibliography{./references}

\end{document}
