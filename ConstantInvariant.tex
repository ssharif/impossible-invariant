\documentclass{amsart}
\usepackage{amsmath, amsthm, amssymb,latexsym,enumerate,mathrsfs}
\usepackage[all]{xy}
\usepackage{enumitem}
\usepackage{hyperref}
\usepackage{invariant}
\usepackage{xcolor}
\usepackage{tikz-cd}
\usepackage{verbatim}
\usepackage{lineno}
\linenumbers

\title[Invariants constant on unpolarized isomorphism classes]{Algebraic invariants constant on unpolarized isomorphism classes of abelian varieties}

%\author[E.\ Rains]{E.\ Rains}
%\address{}
%\email{}
%\author[?]{?}
%\address{}
%\email{}
%\author[A.\ Silverberg]{A.\ Silverberg}
%\address{Department of Mathematics, University of California, Irvine, CA 92697, USA}
%\email{asilverb@uci.edu}
%\subjclass[2010]{??}
%\keywords{abelian varieties}
%\thanks{Support for the research was provided by the Alfred P.~Sloan Foundation
%and the National Science Foundation.}

\begin{document}

\today
\tableofcontents
\maketitle

\section{Introduction}
\label{sec:introduction}

Let $\ag$ be the moduli space of principally polarized abelian varieties. If $A, B$ are abelian varieties, we say $A$ and $B$ are \emph{weakly isomorphic}, written $A \approx B$, if they are isomorphic as unpolarized abelian varieties. Our goal is to show the following.
\begin{theorem}\label{thm:invariant-c-constant}
  Suppose that $R$ is a subring of $\C$. Let $f: \ag \to X$ be a morphism of $R$-schemes. If $f(A) = f(B)$ whenever $A \approx B$, then $f$ is constant.
\end{theorem}
Since a scheme over $\C$ is also scheme over $R$, it suffices to prove the theorem with $R = \C$. We will deduce the theorem as a corollary of the following theorem.

% Let $R$ be a scheme, and for an $R$-scheme $S$ write $S[R]$\textcolor{red}{TODO: is this necessary?} to be the set
% \[
%   \dlim_{T/R} S(T)
% \]
% where the limit is over all $R$-schemes $T$. Let
% \[
%   \sg: \rschemes \to \mathcal{P}((\ag \times \ag)[R])
% \]
% be the functor from $R$-schemes to the power set of $(\ag \times \ag)[R]$ that sends an $R$-scheme $T$ to the set
% \[
%   \sg(T) = \{(A,B) \in (\ag \times \ag)(T) | A \approx B\}.
% \]
% Then we will show the following.
\begin{theorem}\label{thm:sg-c-dense}
  If $R$ is a subring of $\C$, then the set $\sg(R)$ is Zariski dense in the $R$-scheme $\ag \times \ag$.
\end{theorem}
As with Theorem~\ref{thm:invariant-c-constant}, it suffices to address the case where $R = \C$.

\subsection{Overview}

Let $\detl$ denote the set of positive definite symmetric $g \times g$ integral matrices whose determinate is a power of a prime $\ell$ (see Definition~\ref{def:detl}). For a positive integer $N$, let $Y_0(N)$ be the modular curve parametrizing pairs $(E, C)$, where $E$ is an elliptic curve and $C \subset E$ is a cyclic subgroup of order $N$. For any $A \in \detl$, we will define a map $\psimod: Y_0(\det(A)) \to \ag$ (see Section~\ref{sec:curves-on-Ag}). For $A \in \detl$, let $X_A$ denote the image of the map $\psimod: Y_0(\det(A)) \to \ag$.

In Section~\ref{sec:step-1} we prove the following theorem.

\begin{theorem}\label{thm:curves-dense}
  The Zariski closure of $\bigcup_{A \in \detl} X_A$ is $\ag$.
\end{theorem}

In Section~\ref{sec:step-2} we prove the following theorem.

\begin{theorem}\label{thm:Sg-dense}
  If $A,A' \in \detl$, then $\sg \cap (X_A \times X_{A'})$ is Zariski dense in $X_A \times X_{A'}$.
\end{theorem}

\textcolor{red}{TODO: introduce/move}

\begin{proof}[Proof of Theorem~\ref{thm:sg-c-dense}]
  For two subsets $X,Y$ of $\ag \times \ag$, we write $X \prec Y$ if $X \subseteq Y$ and $X$ is Zariski dense in $Y$. Then
  \begin{align*}
    \sg
    &\supseteq
    \sg \cap \left(\bigcup_{A,A'} X_A \times X_{A'}\right)
    \\
    &=
    \bigcup_{A,A'} \sg \cap (X_A \times X_{A'})
    \\
    &\prec
    \bigcup_{A,A'} X_{A} \times X_{A'}
    &&\text{By Theorem~\ref{thm:sg-c-dense}}
    \\
    &=
    \left(\bigcup_{A} X_A\right) \times \left(\bigcup_{A'} X_{A'}\right)
    \\
    &\prec
    \ag \times \ag
    &&\text{By Theorem~\ref{thm:Sg-dense}}.
  \end{align*}
\end{proof}

\textcolor{red}{TODO: introduce/move}

\begin{proof}[Proof of Theorem~\ref{thm:invariant-c-constant}]
  Let $f: \ag \to X$ be a morphism of $R$-schemes. Consider the diagonal $\df$ determined by the diagram
  \[
  \begin{tikzcd}
    \df \arrow[r] \arrow[d] & \ag \arrow[d,"f"]
    \\
    \ag \arrow[r,"f"] & X.
  \end{tikzcd}
  \]
  There is a natural map $\df \to \ag \times \ag$. The hypotheses on $f$ will imply that, viewed as functors, the latter map factors through $\sg$.
  Assume $f$ is separated \textcolor{red}{TODO: is this necessary?}.
  % https://ncatlab.org/nlab/show/separated+morphism+of+schemes
  Then $\df$ is closed in $\ag \times \ag$. By Theorem~\ref{thm:sg-c-dense}, this implies that $\df = \ag \times \ag$, whence the claim follows.\textcolor{red}{TODO: whence? I think this needs more.}
\end{proof}



\section{Constructing curves on $\ag$}
\label{sec:curves-on-Ag}

Fix a prime $\ell$ and positive integer $n$\textcolor{red}{TODO: what constraints are required for $n$?}. In this section we will construct a sequence of maps $Y_0(\ell^n) \to \ag$ whose images $X_i$ are curves in $\ag$. These curves will be used in the steps outlined in Section~\ref{sec:introduction}.

We will describe the maps $Y_0(\ell^n) \to \ag$ in two ways: one based on the moduli interpretation, and one based on complex analysis. The fact that these two interpretations are the same is key to the proof of Theorem~\ref{thm:sg-c-dense}. We will apply the moduli interpretation to prove Theorem~\ref{thm:Sg-dense}, and the complex analytic version to prove Theorem~\ref{thm:curves-dense}. Unfortunately, the latter result does not directly carry over to positive characteristic, so we will need a variant that shows density in $\ao^g$; see \ref{sec:characteristic-p}.

\subsection{Geometric description}
\label{sec:geo-desc}

Fix a positive integer $N$ not divisible by the characteristic of our base field; later we will set $N = \ell^n$. Let $(E, C) \in Y_0(N)$. That is, $E$ is an elliptic curve and $C \subset E$ is a cyclic subgroup of order $N$. Let $A$ be a $g \times g$ symmetric, positive definite integer matrix such that $\det A = N$. The matrix $A$ induces a natural endomorphism $\lambda_A$ of $E^g$. By identifying $E^g$ with its dual, we consider $\lambda_A$ as a polarization of $E^g$; this makes sense since $A$ is symmetric and positive definite. Furthermore, $\deg A = N^2$. Let $K(A) \subset E^g$ be $(\ker \lambda_A) \cap C^g$.

\begin{lemma}
  $K(A)$ is a maximal isotropic subgroup of $\ker \lambda_A$.
\end{lemma}

\begin{proof}
  Let $P \in C$ be a generator, defined over the algebraic closure of our base field. We may identify $C^g$ with $(\Z/N)^g$ via the map $(a_iP) \mapsto (a_i)$. Then $\lambda_A$ induces a map $\lambda_A^{(C)}:C^g \to C^g$ which is given by multiplication by the matrix $A$. One sees that the order of $\ker \lambda_A^{(C)}$ is the square root of the order of $\ker \lambda_A$, and furthermore $\ker \lambda_A^{(C)} \subset C^g$ is isotropic. The claim follows.
\end{proof}

Define $B = E^g/K(A)$, and let $\pi: E^g \to B$ be the quotient map. Then by \cite[Prop. 16.8]{milne-av}, there is a principal polarization $\lambda$ on $B$ for which $\pi^*(\lambda) = \lambda_A$. Since $\pi^*: NS(B) \to NS(A)$ is injective, $\lambda$ is unique.

We define $\psimod: Y_0(N) \to \ag$ by
\[
  \psimod(E,C) = (B,\lambda).
\]


\begin{proposition}\label{prop:psimod-weakly-isomorphic-to-product}
  Let $d_1, \cdots, d_g$ be the elementary divisors of $A$, and for $(E,C) \in Y_0(N)$, let $E_i = E/(N/d_i)C$. If $\psimod(E,C) = (B,\lambda)$, then
  \[
    B \approx E_1 \times \cdots \times E_g.
  \]
\end{proposition}

\begin{proof}
  Let
   \[
     D =
    \begin{bmatrix}
      {d_1} & & & \\
      & {d_2} & & \\
      & & \ddots & \\
      & & & {d_{g}}
    \end{bmatrix}
  \]
  be the Smith normal form of $A$. Then there are matrices $U,V \in \Gl_g(\Z)$ such that $A = UDV$. Each of these matrices induces a natural endomorphism of $E^g$; we use $\rho_M$ to denote the endomorphism corresponding to the matrix $M$. We have $\rho_A = \rho_U \rho_D \rho_V$, and $\rho_U, \rho_V$ are isomorphisms. We also have that
  \begin{align*}
    \ker \rho_D &= E[d_1] \times E[d_2] \times \cdots \times E[d_g]
  \end{align*}
  and so $(\ker \rho_D) \cap C^g = (N/d_1)C \times \cdots \times (N/d_g)C$. Furthermore, $\rho_V(C^g) = C^g$, and so
  \[
    \rho_V((\ker \rho_A) \cap C^g) = (\ker \rho_D) \cap C^g.
  \]
  Therefore the quotients of $E^g$ by $(\ker \rho_A) \cap C^g$ and $(\ker \rho_D) \cap C^g$ respectively are (weakly) isomorphic. The claim follows.
\end{proof}

\subsection{Analytic description}
\label{sec:ana-desc}

Suppose that $A$ is a symmetric, positive definite integer matrix with $\det A = N \neq 0$. Define a map $\psi_A: \hh \to \hh_g$ by
\[
  \psi_A(\tau) = \tau A.
\]
\begin{proposition}
The map $\psi_A$ descends to a map
\begin{equation}\label{def:psi-A-n}
  \psimodt: Y_0(N) \longrightarrow \ag.
\end{equation}
\end{proposition}

\begin{proof}
Recall that $Y_0(N) = \hh/\Gamma_0(N)$ and $\ag = \hh_g/\Sp_{2g}(\Z)$. Let 
\[
\sigma = \begin{bmatrix} a & b \\ c & d \end{bmatrix} \in \Gamma_0(N)
\]
and let $\tau \in \hh$. A direct computation shows that the matrix 
\[
M = \begin{bmatrix} aI & bA \\ cA^{-1} & dI \end{bmatrix}
\]
lies in $\Sp_{2g}(\Z)$
% it is integral because \det(A) | c, so cA^{-1} is integral.
% M is in Sp because then M^t*\Omega*M = M
% where \Omega = \begin{matrix} 0 & I \\ -I & 0 \end{matrix}
and that $\sigma(\tau)A = M(\tau A)$.
\end{proof}

In fact, $\psimodt$ is none other than $\psimod$, from which one can obtain an alternative proof of the previous proposition.
\begin{proposition}
  The maps $\psimodt$ and $\psimod$ are equal.
\end{proposition}

\begin{proof}
  If $(E, C) \in Y_0(N)$ corresponds to the point $\tau \in \hh$, then we may take $E = \C/\langle 1, \tau \rangle$ and $C = \langle 1/N \rangle$. We first show that $\psimodt(E,C) \approx \psimod(E,C)$.

  Let $\Lambda = \Z^g + \tau \Z^g \subset \C^g$. Observe that $\C^g/\Lambda = E^g$, where projection on the $i$th complex coordinate is the same as projection onto the $i$th factor of $E^g$. Let
  \[
    \tla = \Z^g + \tau A \Z^g.
  \]
  One sees that $\psimodt(\tau) \approx \C^g/\tla$. Let
  \[
    \Lambda_A = A^{-1}\Z^g + \tau \Z^g.
  \]
  Multiplication by $A^{-1}: \C^g \to \C^g$ induces an isomorphism
  \[
    \C^g/\tla \xrightarrow{\sim} \C^g/\Lambda_A.
  \]
  Furthermore, $\Lambda_A \subset A$, so we have a natural isogeny
  \[
    \rho: E^g = \C^g/\Lambda \to \C^g/\Lambda_A.
  \]
  We wish to compute $\ker \rho$.

  Multiplication by $A: \C^g \to \C^g$ induces an isogeny
  \[
    \rho_A: \C^g/\Lambda \longrightarrow \C^g/\Lambda.
  \]
  This is the same isogeny $\rho_A$ as given in the proof of Prop.~\ref{prop:psimod-weakly-isomorphic-to-product}; that is, it is the natural isogeny $E^g \to E^g$. Then $\ker \rho_A = A^{-1}\Z^g + \tau A^{-1} \Z^g \pmod{\Lambda}$. Recall, with our identification $E = \C/(\Z + \tau\Z)$, that the distinguished subgroup $C \subset E$ is $\langle 1/N \rangle$. Then $C^g \subset E^g$ is $\frac{1}{N}\Z^g \pmod{\Lambda}$. It follows that $\ker \rho = (\ker \rho_A) \cap C^g = K(A)$. Since $\psimod(E,C) \approx E^g/K(A)$, we have proven that $\psimod(E,C) \approx \psimodt(E,C)$.

  To specify a polarization on a $g$-dimensional complex abelian variety, one can either given an isogeny from the abelian variety to its dual, or one can give an appropriate Riemann form $H$ on $\C^g$; see, for example, \cite{rosen-avc} for this and other relevant background. The data of the form $H$ can be deduced from the correpsonding \emph{alternating Riemann form} $E$; more precisely, $H(u,v) = E(iu,v) + i E(u,v)$. For a point $\Omega \in \hh_g$, the corresponding abelian variety is
\[
\C^g/(\Z^g + \Omega \Z^g),
\]
and the corresponding alternating Riemann form is the unique such form $E$ satisfying, for $u,v \in \Z^g$, $E(u,\Omega v) = u^tv$. We call such a form the \emph{Siegel form} arising from $\Omega \in \hh_g$; this form specifies the principal polarization for the class of $\Omega$ in $\ag$. For example, if $\Omega = \tau I$ for $\tau \in \hh$, so that the abelian variety is $E^g$, then the Siegel form corresponds to the product principal polarization.

Now consider the (nonprincipal) polarization $\rho_A$ on $E^g$. The corresponding alternating Riemann form is $E_A(u,\tau v) = u^tAv$, where $u,v \in \Z^g$. But observe that $E_A(\Lambda_A \times \Lambda_A) \subset \Z$, and so $E_A$ gives rise to a Riemann form for $\C^g/\Lambda_A$ as well. Write $\lambda$ for the polarization corresponding to $E_A$. Then by definition of $\psimod$, we have
\[
  \psimod(E,C) = (\C^g/\Lambda_A, \lambda).
\]
Let $\tilde{\lambda}$ be the polarization coming from the Siegel form for $\tau A$. Multiplication by $A$ on $\C^g$ induces an isomorphism of polarized abelian varieties
\[
  (\C^g/\Lambda_A, \lambda) \xrightarrow{\sim} (\C^g/\tla, \tilde{\lambda}).
\]
But $\psimodt(E,C) = (\C^g/\tla, \tilde{\lambda})$, and thus the claim is proved.


 % Furthermore, this polarization is specified by letting the columns be a symplectic basis for the associated Riemann form $H: \C^g \times \C^g \to \C$; this is precisely the product polarization.

 %  The abelian variety $B$ associated to $\psi_A(\tau)$ is $\C^g/\tilde{\Lambda}$, where $\tilde{\Lambda}$ is the lattice generated by the columns of
 %  \[
 %    \begin{bmatrix}
 %      I | \tau A
 %    \end{bmatrix},
 %  \]
 %  and with the associated principal polarization.
\end{proof}
% Write $\Omega$ for $\tau I$, where $I$ is the $g \times g$ identity matrix. The period matrix for $\psi_{I,n}(\tau)$ is
% \[
%   M = \begin{bmatrix}
%     I | \Omega
%   \end{bmatrix}.
% \]
% Observe that if $E$ is the elliptic curve corresponding to $\tau \in \hh$, then the abelian variety corresponding to $\psi_{I,n}(\tau) \in \hh_g$ is $E^g$ with the product polarization.

% Given a period matrix $M$, let $\Lambda(M)$ be the lattice generated by the columns of $M$, so that the corresponding abelian variety is $A(M) := \C^g/\Lambda(M)$. We say two period matrices $M, M'$ are \emph{equivalent} if $\C^g/\Lambda(M)$ is isomorphic to $\C^g/\Lambda(M')$, and similarly the matrices are \emph{weakly equivalent} if the abelian varieties are weakly isomorphic. Let $D$ be the Smith normal form of $A$, so that there are $U,V \in \Gl_g(\Z)$ for which $A = UDV$. Then the period matrix for $\Psi_{A,n}(\tau)$ is
% \[
%   \begin{bmatrix}
%     I | \Omega A
%   \end{bmatrix},
% \]
% which is equivalent to
% \[
%   \begin{bmatrix}
%     D^{-1}U^{-1} | V
%   \end{bmatrix}
% \]
% and hence weakly equivalent to
% \[
% M' = \begin{bmatrix}
%     D^{-1}U^{-1} | \Omega
%   \end{bmatrix}.
% \]
% Let $M''$ be the period matrix\[
%   \begin{bmatrix}
%     D^{-1} | \Omega
%   \end{bmatrix}.
% \]
% The matrix $D^{-1}$ is a diagonal matrix whose diagonal entries are powers of $1/\ell$. Suppose the $i$th diagonal entry is $1/\ell^{n_i}$, and set
% \[
%   \vec{n} = (n_1, \ldots, n_g).
% \]
% One sees that $A(M'') = \psivec(\tau)$, where $\lambda$ is the product polarization. In particular, if $P \in E$ generates the distinguished $\ell^n$-torsion subgroup, then
% \[
%   A(M'') = E/\langle \ell^{n-n_1} P \rangle \times \cdots \times E/\langle \ell^{n-n_g} P \rangle.
% \]
% The abelian variety $A(M')$ is similary a quotient of $E^g$ by an $\ell$-power subgroup. But the natural map $U: E^g \to E^g$ sends one kernel subgroup to another, and thus induces a (weak) isomorphism $A(M') \to A(M'')$. As $A(M'') = \psivec(\tau)$ and $A(M')$ is weakly isomorphic to $A(M) = \psimat(\tau)$, we conclude that
% \[
% \psimat(\tau) \textrm{ and } \psivec(\tau)
% \]
% are weakly isomorphic.

\newpage

\section{Step 1}
\label{sec:step-1}

The main goal of this section is to prove Theorem~\ref{thm:curves-dense}.

\begin{lemma}\label{lemma:sl-z-1overl-dense-sl-r}
  The topological closure of $\Sl_g(\Z[1/\ell])$ is $\Sl_g(\R)$.
\end{lemma}
Here, the topology is the one induced by the Euclidean metric on the entries.

\begin{proof}
  Let $G \in \Sl_g(\R)$. Factor $G$ as a product of elementary matrices
  \[
    G = E_n \cdots E_2 E_1
  \]
  where $\det E_i = \pm 1$. Observe that, with at most one exception, the entries of each $E_i$ are $0$ or $\pm 1$. Thus we can find a $g \times g$ matrix $E_i'$ with entries in $\Z[1/\ell]$ and $\det E_i' = \det E_i$ which is arbitrarily close to $E_i$. Let $G' = E_n' \cdots E_1'$. Certainly $G' \in \Sl_g(\Z[1/\ell])$. Since matrix multiplication is continuous, $G'$ is close to $G$.
\end{proof}

% \begin{proof}[Alternative proof]
%   Let $G = [g_{ij}] \in \Sl_g(\R)$. Let $X = [x_{ij}]$ be a matrix of $g^2$ variables, and consider the determinant map $\det: \R[\{x_{ij}\}] \to \R$. Choose $r,s$ so that
%   \[
%     \frac{\partial \det}{\partial x_{rs}}(G) \neq 0.
%   \]
%   Since $\Z[1/\ell]$ is dense in $\R$, for $(i,j) \neq (r,s)$ we can find $a_{ij} \in \Z[1/\ell]$ which is arbitrarily close to $g_{ij}$. By our hypotheses on $(r,s)$, there exists $a_{rs} \in \R$ such that $\det [a_{ij}] = 1$. Clearly $a_{rs} \in \Z[1/\ell]$. The determinant is continuous, so $a_{rs}$ must also be close to $g_{rs}$.
% \end{proof}

% \begin{proof}
%   The group scheme $\Sl_g$ is a connected reductive group, and hence is unirational. (???cite) Since $\Z[1/\ell]$ is topologically dense in $\R$, the claim follows.

%   Details: unirational means there is a dominant rational map $f:\Pro^n \to \Sl_g$ for some $n$. Given $G \in \Sl_g(\R)$, there some $G' \in f(\Pro^n(\R))$ which is close to $G$. Let $P \in \Pro^n(\R)$ with $f(P) = G'$. Then
% \end{proof}

\begin{definition}\label{def:detl}
  For $\ell$ a prime, let $\detl$ be the set of $g \times g$ symmetric, positive definite integer matrices $N$ for which $\det N$ is a power of $\ell$.
\end{definition}

\begin{lemma}\label{lemma:ggt-spd-detl}
  If $G \in \Sl_g(\Z[1/\ell])$, then for all sufficiently large $n \in \N$,
  \[
    \ell^n GG^t \in \detl.
  \]
\end{lemma}

\begin{proof}
  Certainly for all $n$, $\ell^n GG^t$ will be symmetric, positive definite, and have determinant which is an integer power of $\ell$. Choose $N$ to be the maximum power of $\ell$ appearing in the denominators of the entries of $GG^t$. Then for $n \geq N$, $\ell^n GG^t$ is an integer matrix.
\end{proof}


\begin{definition}
  Let $\permat$ be the set of $g \times g$ real, positive definite symmetric matrices  with determinant $1$.
\end{definition}

\begin{lemma}\label{lemma:ggt-periodmatrices}
  $\permat = \{GG^t | G \in \Sl_g(\R)\}$.
\end{lemma}

\begin{proof}
  Suppose $A \in \permat$. By the Spectral Theorem, there exist a real orthogonal matrix $O$ and a real diagonal matrix $D$ such that $A = ODO^t$. Let $D$ have diagonal entries $d_1, d_2, \dots, d_n$. Since $A$ is positive definite, $d_i > 0$ for all $i$. Furthermore, $\prod d_i = \det A = 1$. Let
  \[
    G = O
    \begin{bmatrix}
      \sqrt{d_1} & & & \\
      & \sqrt{d_2} & & \\
      & & \ddots & \\
      & & & \sqrt{d_{g}}
    \end{bmatrix}.
\]
Then $A = GG^t$ and $G \in \Sl_g(\R)$.
\end{proof}

\begin{proposition}\label{prop:A-over-detA}
  The topological closure of ${\{A/(\det A)^{\frac{1}{g}} | A \in \detl\}}$ is $\permat$.
\end{proposition}

\begin{proof}
  In the set
  \[
    \{A/(\det A)^{\frac{1}{g}} | A \in \detl\},
  \]
  by Lemma~\ref{lemma:ggt-spd-detl}, we may replace $A$ with $\ell^n GG^t$ with $G \in \Sl_g(Z[1/\ell])$, $n$ sufficiently large (depending on $G$). But $\det (\ell^n GG^t) = \ell^n$, so the above set equals
  \[
    \{GG^t | G \in \Sl_g(\Z[1/\ell])\}.
  \]
  The claim follows from combining Lemmas~\ref{lemma:sl-z-1overl-dense-sl-r} and \ref{lemma:ggt-periodmatrices}.
\end{proof}

Let $\R^+$ denote the set of positive real numbers.
\begin{lemma}\label{lemma:holomorphic-closure-irM}
  The holomorphic closure of ${\{ irM | M \in \permat, r \in \R^+\}}$ is $\hh_g$.
\end{lemma}
Here, the holomorphic closure of a set $X$ means the smallest set $\overline{X}$ containing $X$ for which any holomorphic function that vanishes on $X$ also vanishes on $\overline{X}$. Observe that the Euclidean topology is a refinement of the holomorphic topology, which is a refinement of the Zariski topology.

\begin{proof}
  Notice that the set $H := \{ irM | M \in \permat, r \in \R^+\}$ is precisely the subset of $\hh_g$ with realpart $0$. Note that $H$ is a real manifold with $\dim_{\R} H = g(g+1)/2$. So by \cite[Ch.~4.8]{krantz2017harmonic}, it is enough to show that $H$ is a totally real. That is, we need to show that the tangent space \textcolor{red}{TODO: figure out correct property}

  As $H$ is a topological group (it is isomorphic to $\R^+ \times \detl$), it is enough to consider the tangent space at the identity $iI_g$. The exponential map goes from \textcolor{red}{TODO: finish}
\end{proof}

% \begin{lemma}
%   The holomorphic closure of ${\bigcup_{A \in \detl} \psi_A(i\R^+)}$ is $\hh_g$.
% \end{lemma}

% \begin{proof}
% \end{proof}

% \begin{lemma}
%   \[
%     \hclos{\bigcup_{A \in \detl} \im \psi_A} = \hh_g.
%   \]
% \end{lemma}

% \begin{proof}
%   Since $\psi_A(i\R^+) \subset \im \psi_A$, the claim follows from the previous lemma.
% \end{proof}

\textcolor{red}{TODO: alter this to prove Theorem~\ref{thm:curves-dense} directly}
\begin{theorem}
  The Zariski closure of
  \[
    {\bigcup_{A \in \detl} \im \psimod}
  \]
  is $\ag$.
\end{theorem}

\begin{proof}
  Observe that if $X$ is a subset of a complex manifold, then its topological closure is contained in its holomorphic closure. Now
  \begin{align*}
    \cup_A \psi_A(i\R^+) &= \cup \{irA | r \in \R^+, A \in \detl\} \\
               &= \cup \{irA/(\det A)^{\frac{1}{g}} | r \in \R^+, A \in \detl\}.
  \end{align*}
  By Proposition~\ref{prop:A-over-detA}, the topological closure of the above set is
  \[
    \{irM | r \in \R^+, M \in \permat\}.
  \]
  By Lemma~\ref{lemma:holomorphic-closure-irM}, the holomorphic closure of $\cup_A \psi_A(i\R^+)$ is $\hh_g$. Therefore the holomorphic closure of $\cup_A \im \psi_A$ is also $\hh_g$. Passing to the quotient, if we consider $\ag$ as a complex manifold, we have that $\cup_A \im \psimod$ is holomorphically dense in $\ag$.

  By definition of $\psimod$,  $\im \psimod \subset \ag$ is the image of $\im \psi_A \subset \hh_g$ under the canonical covering map $\hh_g \to \ag$. As we have shown, $\im \psi_A$ is holomorphically dense in $\hh_g$, and so the image of $\psimod$ in $\ag$ is holomorphically dense when viewing $\ag$ as a complex manifold. But holomorphically dense implies Zariski dense, and the claim follows.
\end{proof}



\section{Step 2}
\label{sec:step-2}

The main goal of this section is to prove Theorem~\ref{thm:curves-dense}.

\textcolor{red}{TODO: introduce lemmas}

\begin{lemma}\label{lem:silly}
  Let $\ell$ be a prime. Then there is a quadratic imaginary field $K$ such that $\ell$ splits into principal primes in $K$ and $\sO_K^\times = \{\pm 1\}$.
\end{lemma}
\begin{proof}
  The possible fields $K$ in which $\ell$ splits into principal primes are precisely the fields generated by the polynomials $x^2 - tx + \ell$ with $0 < |t| < 2\sqrt{\ell}$. There are $2\lfloor 2\sqrt{\ell} \rfloor$ such polynomials. Recall that there are, up to Galois conjugates, $\leq 4$ elements of norm $\ell$ in $\Q(i)$ and $\leq 6$ in $\Q(\sqrt{-3})$. Therefore, if $4\sqrt{\ell} > 10$ then there are more than $10$ such polynomials, so one must correspond to a field other than $\Q(i)$ and $\Q(\sqrt{-3})$. The the remaining primes $\ell < 7$ can be checked by hand.
\end{proof}

\begin{lemma}\label{lem:K-exists}
  Let $g$ be a positive integer and $\ell$ a prime. Then there exists a quadratic imaginary field $K$ such that
  \begin{enumerate}
    \item $\sO_K^\times = \{\pm 1\}$
    \item $\ell$ splits in $K$ into principal primes $\alpha\sO_K \cdot \overline{\alpha}\sO_K$
    \item There is an infinite number of rational primes $q$ such that
    \begin{enumerate}
      \item $q$ is inert in $K$
      \item $q \equiv -1 \mod{g}$
      \item $\alpha \mod q\sO_K \in \sO_K/q\sO_K$ is a $g$th power.
    \end{enumerate}
  \end{enumerate}
\end{lemma}
\begin{proof}
  By Lemma~\ref{lem:silly}, we can find a $K$ satisfying the first two properties. Let $L = K(\zeta_g,\alpha^{1/g},\overline{\alpha}^{1/g})$. Let $\frak{q}$ be a prime of $L$ lying over a prime $q$ of $\Q$. Let $\sigma = \mathrm{Frob}(\frak{q}) \in \Gal(L/\Q)$. Note that $q$ is inert in $K$ if and only if $\sigma|_K$ is complex conjugation. Similarly, $q \equiv -1 \mod{g}$ if and only if $\sigma|_{\Q(\zeta_g)}$ is complex conjugation.
%To see this, note that under the usual isomorphism $\Gal(\Q(\zeta_g)/\Q) \cong (\Z/g\Z)^\times$, complex conjugation is associated to $-1$. The map Frobenius element corresponding to $\frak{q} \cap \Q(\zeta_g)$ sends $\zeta_g \mapsto \zeta_g^c$.
Finally, if $\sigma$ has order $2$, then $\sO_L/\frak{q} \cong \sO_K/q\sO_K \cong \F_{q^2}$. In particular, $\alpha^{1/g}$ is a $g$th root of $\alpha$ in $\F_{q^2}$. Moreover, if $\sigma$ satisfies these conditions, then so does any conjugate of $\sigma$. So by Chebotarev's density theorem, it remains to show there exists some $\sigma \in \Gal(L/\Q)$ such that $\sigma$ has order $2$ and restricts to complex multiplication in $K$ and $\Q(\zeta_g)$.

  Choose any embedding $\iota: L \to \C$ and define $\sigma \in \Gal(L/\Q)$ by $a \mapsto \iota^{-1}(\overline{\iota(a)})$. Note that $\sigma$ has order $2$. Because $K$ and $\Q(\zeta_g)$ are CM fields, $\sigma$ restricts to the usual complex conjugation on them. Therefore $\sigma$ has the desired properties.
\end{proof}

\textcolor{red}{TODO: introduce lemmas}

\begin{definition}
  If $K$ is a quadratic imaginary field $K$, then we let $\Gt_q$ denote the group $(\sO_K/q\sO_K)^\times/(\Z/q\Z)^\times$. The field $K$ should be clear from context.
\end{definition}

\begin{lemma}\label{lem:c-torsor}
  Let $E$ be an elliptic curve over an algebraically closed field with $\End(E) \cong \sO_K$ for some imaginary quadratic field $K$. Let $q$ be a prime not equal to the characteristic of the base field and inert in $K$. Then the set of subgroups of $E$ with order $c$ form a $\Gt_q$ torsor.
\end{lemma}
\begin{proof}
  Note that $E[q]$ is an $\sO_K/q\sO_K \cong \F_{q^2}$ module of size $q^2$. Therefore it is isomorphic to $\F_{q^2}$ as an $\F_{q^2}$ vector space. So $(\F_{q^2})^\times/(\F_q^\times) \cong \Gt_q$ acts freely and transitively on the $1$ dimensional $\F_q$-submodules.
\end{proof}

\begin{definition}[{\cite[Sec.~2]{kani2011products}}]\label{def:ker-idl}
  Let $A$ be an abelian variety over a field $K$. Given a regular left-ideal $I$ of $\End A$, let $H(I) = \cap_{\phi \in I}\ker \phi$. A finite subgroup scheme $H$ is a \emph{ideal subgroup} if $H = H(I)$ for some $I$. Symmetrically, given such an $H$, let $I(H) = \{\phi \in \End A \colon \phi(H) = 0\}$. We say $I$ is a \emph{kernel ideal} if it is the form $I(H)$ for some $H$.
\end{definition}

\begin{theorem}[{\cite[Thm.~20b]{kani2011products}}]\label{thm:kani-20b}
  Let $E$ be a CM elliptic curve over an algebraically closed field, and $H$ a finite subgroup scheme of $E$. Then $H$ is a kernel ideal if and only if there is an inclusion $\End E \hookrightarrow \End E/H$. Moreover, if $H_1,H_2$ are ideal subgroups of $E$, then $E/H_1 \approx E/H_2$ if and only if $I(H_1)$ is isomorphic to $I(H_2)$ as $\End(E)$ modules.
  %$f_{E_H} \mid f_E$
\end{theorem}

\begin{lemma}\label{lem:c-end}
  Let $E$ be an elliptic curve over an algebraically closed field with $\End(E) \cong \sO_K$ for some imaginary quadratic field $K$. Let $q$ be a product of primes not equal to the characteristic of the base field and inert in $K$. If $\sC$ is a subgroup of $E$ of order $q$, then $\End(E/\sC) \cong \Z + q\sO_K$. In particular, every endomorphism of $E/\sC$ is induced by an endomorphism of $E$ that takes $\sC$ to $\sC$.
\end{lemma}
\begin{proof}
  Factor $q = \prod_{i=1}^n q_i$, where each $q_i$ is a prime not equal to the characteristic of the base field, and is inert in $K$. We can write $\sC = \sum_{i=1}^n \sC_i$ where each $\sC_i$ is a subgroup of order $q_i$.

  The isogeny $\pi: E \to E/\sC$ factors into a chain of isogenies
  \[
    E
    \xrightarrow{\pi_1}
    E/\sC_1
    \xrightarrow{\pi_2}
    E/(\sC_1 + \sC_2)
    \xrightarrow{\pi_3}
    \cdots
    \xrightarrow{\pi_n}
    E/\sum_{i=1}^n\sC_i.
  \]
  Let $E_j = E/\sum_{i=1}^j\sC_i$ so $\pi_j: E_{j-1} \to E_j$. Recall that $\End(E_j)$ is isomorphic to an order in $K$, say $\sO_j$. Because $\pi_j$ has degree $c_j$, we know that $[\sO_j : \sO_{j-1}] = q_j$, $[\sO_{j-1} : \sO_j] = q_j$, or $\sO_{j-1} = \sO_j$ \cite[Prop.~5]{kohel1996endomorphism}. Therefore the index of $\sO_j$ in $\sO_K$ divides $\prod_{i=1}^{j}q_i$. Recall from \cite[Prop.~7.20]{cox2011primes} that ideals of $\sO_j$ that are prime to $f_j$ are in bijection with primes of $\sO_K$ avoiding $f_j$. In particular, there is no prime of $\sO_{j-1}$ of norm $q_j$. So $\ker\pi_j$ is not an ideal subgroup \cite[Prop.~23]{kani2011products}. Then by Theorem~\ref{thm:kani-20b}, $[\sO_{j-1} : \sO_j] = q_j$. It follows that $[\sO_K : \sO_n] = \prod_{i=1}^n q_i$ as required.
\end{proof}

\begin{lemma}\label{lem:c-subgps-distinct-quotients}
  Let $E$ be an elliptic curve over an algebraically closed field with $\End E \cong \sO_K$ for some imaginary quadratic field $K$ with $\sO_K^\times = \{\pm 1\}$. Let $q$ be a prime not equal to the characteristic of the base field and inert in $K$. If $\alpha,\beta \in \sO_K$ are prime to $q$, then $E/\alpha(\sC) \approx E/\beta(\sC)$ if and only if $\alpha(\sC) = \beta(\sC)$.
\end{lemma}
\begin{proof}
  Note that $\alpha(\sC) = (\alpha\overline{\beta})(\beta(\sC))$ so up to replacing $\sC$ with $\beta(\sC)$ and $\alpha$ with $\alpha\overline{\beta}$, it is enough to prove the claim for $\beta = 1$.

  If $\alpha(\sC) = \sC$, then it is clear that $E/\alpha(\sC) \approx E/\sC$, so it suffices to show the other direction. Let $\tilde{u}: E/\alpha(\sC) \to E/\sC$ be an isomorphism. We want to show that $\sC = \alpha(\sC)$.

  Let $\pi_{\sC}$ denote the quotient map $E \to E/\sC$. Note that $\alpha$ induces an isogeny $\tilde{\alpha}: E/\sC \to E/\alpha(\sC)$ defined by the equation $\tilde{\alpha}\circ\pi_{\sC} = \pi_{\alpha(\sC)} \circ \alpha$. The map $\tilde{u}\circ\tilde{\alpha}$ is an endomorphism of $E/\sC$. By Lemma~\ref{lem:c-end}, $\tilde{u}\circ\tilde{\alpha}$ is induced by some $\alpha' \in \sO_K$ that fixes $\sC$. That is, $\pi_{\sC}\circ\alpha' = \tilde{u}\circ\tilde{\alpha}\circ\pi_{\sC} = \tilde{u}\circ\pi_{\sC}\circ\alpha$. This shows that $\deg(\alpha) = \deg(\alpha')$\textcolor{red}{TODO: do we need $\alpha$ prime to be separable?}. Because $\alpha$ and $\alpha'$ are prime to $q$,
  \[
    \sC \times \ker(\alpha')
    \cong
    \ker(\pi_{\sC} \circ \alpha')
    =
    \ker(\tilde{u}\circ\pi_{\sC}\circ\alpha)
    =
    \ker(\pi_{\sC}\circ\alpha)
    \cong
    \sC \times \ker(\alpha).
  \]
  Therefore $\ker(\alpha) = \ker(\alpha')$, so $\alpha' = \alpha\circ u$ for some $u \in \sO_K^\times$. By hypothesis, $u = \pm 1$. So $\alpha(\sC) = \pm\alpha'(\sC) = \pm\sC = \sC$.

  %Alternate proof of existence of u: $E/\alpha(\sC)$ and $E/\sC$ have a unique ascending isogeny. As $\tilde{u}$ is an isomorphism, it must send the ascending kernel of $E/\alpha(\sC)$ to that of $E/\sC$. The ascending kernel is the image of $E[c]$ under the quotient. Therefore $\pi^{\vee}\circ\tilde{u}\circ\pi_{\alpha(\sC)}$ is divisible by $c$, and so factors through an automorphism of $E$.
\end{proof}

\begin{lemma}\label{lem:prod-equiv-torsor}
  Let $E$ be an elliptic curve over an algebraically closed field with $\End E \cong \sO_K$ for some imaginary quadratic field $K$ with $\sO_K^\times = \{\pm 1\}$. Let $q$ be a prime not equal to the characteristic of the base field and inert in $K$. Let $\sC$ be a subgroup of $E$ of order $q$. If $\alpha_1,\dots,\alpha_g,\beta_1,\dots,\beta_g \in \sO_K$ are prime to $q$, then
  \[
    \prod_{i=1}^g E/\alpha_i(\sC) \approx \prod_{i=1}^g E/\beta_i(\sC)
    \,\Leftrightarrow\,
    \prod_{i=1}^g \alpha_i \equiv \prod_{i=1}^g \beta_i \text{ in } \Gt_q.
  \]
\end{lemma}
\begin{proof}
  Let $\alpha = \prod_{i=1}^g\alpha_i$ and $\beta = \prod_{i=1}^g\beta_i$. Let $M$ be the diagonal matrix with diagonal entries $\alpha_1^{-1},\dots,\alpha_{g-1}^{-1}, \alpha_g^{-1}\alpha$. Note that $M\mod{c\sO_K} \in \Sl_g(\sO_K/q\sO_K)$. By \cite[Cor.~5.2, Pg.~18]{ktheory1964bass}, we can find $M' \in \Sl_g(\sO_K)$ such that $M \equiv M' \mod{q\sO_K}$. The matrix $M'$ corresponds to an automorphism of $E^g$ sending $\prod_{i=1}^g \alpha_i(\sC)$ to $\sC^{g-1} \times \left(\prod_{i=1}^g \alpha_i\right)(\sC)$. A similar construction with $\beta$ shows that
  \[
    \prod_{i=1}^g E/\alpha_i(\sC) \approx \prod_{i=1}^g E/\beta_i(\sC)
    \,\Leftrightarrow\,
    \left(E/\sC\right)^{g-1} \times E/\alpha(\sC) \approx \left(E/\sC\right)^{g-1} \times E/\beta(\sC).
  \]

  Note that $\alpha$ induces an isogeny $\tilde{\alpha}: E/\sC \to E/\alpha(\sC)$. Let $\sO = \Z + q\sO_K$, which by Lemma~\ref{lem:c-end} is isomorphic to $\End(E/\sC)$, $\End(E/\alpha(\sC))$, and $\End(E/\beta(\sC))$. Thus $\ker\tilde{\alpha}$ is an ideal subgroup by Theorem~\ref{thm:kani-20b}. The same holds for $\beta$ as well.

  %I(\phi) = \{f \in \End E/\sC \colon \ker f \supseteq \ker \phi \}
  For an isogeny $\phi$ with domain $E/\sC$, let $I_\phi$ denote the kernel ideal of $\ker(\phi)$, i.e. $I_\phi = \{f \in \End(E/\sC) \colon f(\ker(\phi)) = 0\}$.
  By \cite[Thm.~46]{kani2011products},
  \begin{align*}
    \left(E/\sC\right)^{g-1} \times E/\alpha(\sC) \approx \left(E/\sC\right)^{g-1} \times E/\beta(\sC)
    \\
    \Leftrightarrow
    \left(\bigoplus_{i=1}^{g-1} \sO\right) \oplus I_{\tilde{\alpha}} \cong \left(\bigoplus_{i=1}^{g-1} \sO\right) \oplus I_{\tilde{\beta}},
  \end{align*}
  where the second isomorphism is as $\sO$-modules. By \cite[Thm.~48]{kani2011products} (see also \cite[Rem.~49b]{kani2011products}), the latter isomorphism is equivalent to $I_{\tilde{\alpha}} \cong I_{\tilde{\beta}}$.
  By Theorem~\ref{thm:kani-20b},
  \[
    I_{\tilde{\alpha}} \cong I_{\tilde{\beta}}
    \,\Leftrightarrow\,
    E/\alpha(\sC) \approx E/\beta(\sC).
  \]
  By Lemma~\ref{lem:c-subgps-distinct-quotients},
  \[
    E/\alpha(\sC) \approx E/\beta(\sC)
    \,\Leftrightarrow\,
    \alpha(\sC) = \beta(\sC).
  \]
  By Lemma~\ref{lem:c-torsor}, $\alpha(\sC) = \beta(\sC)$ if and only if $\alpha \equiv \beta$ in $\Gt_q$.
\end{proof}

\begin{lemma}\label{lem:lim-degree}
  Let $A,A' \in M_{g \times g}(\Z)$ be positive definite symmetric matrices such that $\det(A) = \ell^n$ and $\det(A') = \ell^m$ for a prime $\ell$. Let $X_A$ and $X_{A'}$ denote the images of the maps $\psi_A: Y_0(\ell^n) \to \ag$ and $\psi_{A'}: Y_0(\ell^m) \to \ag$. Then there exists a sequence $x_i \in Y_0(\ell^n)$ such that
  \[
    \lim_{i \to \infty}\#\left\{ y \in Y_0(\ell^m) \colon \psi_A(x_i) \approx \psi_{A'}(y) \right\} = \infty.
  \]
\end{lemma}
\begin{proof}
  Choose a quadratic imaginary field $K$, principal prime $\alpha\sO_K$ lying over $\ell$, and rational primes $q_i$ as in Lemma~\ref{lem:K-exists}. We may assume $q_i \neq \ell$ for any $i$. Let $E$ be an elliptic curve over an algebraically closed field with endomorphism ring $\End(E) \cong \sO_K$.

  If $\sC$ is a cyclic subgroup of $E$ with order prime to $\ell$, then $\alpha$ induces a chain of isogenies
  \[
    E/\sC \to E/\alpha(\sC) \to \cdots \to E/\alpha^n(\sC).
  \]
  Let $\alpha_{\sC,n}: E/\sC \to \cdots \to E/\alpha^n(\sC)$ be the composition of this chain. Then $\alpha_{\sC,n}$ is a cyclic $\ell^n$-isogeny, so the pair $(E/\sC,\alpha_{\sC,n})$ defines a point in $Y_0(\ell^n)$.

    For each $i$, we fix a cyclic subgroup $\sC_i$ of $E$ with order $q_i$. Define $x_1$ to be $(E/\sC_1,\alpha_{\sC_1,n})$, $x_2$ to be $(E/(\sC_1 + \sC_2), \alpha_{\sC_1 + \sC_2,n})$, and similarly for $x_i$. Note that the $x_i$ are distinct points, as the curves all have different endomorphism rings by Lemma~\ref{lem:c-end}.

    Next we will construct the values of $y \in Y_0(\ell^m)$ such that $\psi_{A'}(y) = \psi_{A}(x_i)$. We first focus on the case $i = 1$. By Proposition~\ref{prop:psimod-weakly-isomorphic-to-product}, $\psi_{A}(x_1) \approx E/\alpha^{n_1}(\sC_1) \times \cdots \times E/\alpha^{n_g}(\sC_1)$, where $\ell^{n_1},\dots,\ell^{n_g}$ are the elementary divisors of $A$. By our choice of $K$, $\alpha$ is a $g$th power in $\sO_K/q_1\sO_K$, so we can find $\gamma \in \sO_K$ such that $\alpha \equiv \gamma^g \mod{q_1\sO_K}$. By Lemma~\ref{lem:c-torsor}, $\alpha(\sC_1) = \gamma^g(\sC_1)$ and
    \[
      \psi_{A}(x_1) \approx E/\gamma^{gn_1}(\sC_1) \times \cdots \times E/\gamma^{gn_g}(\sC_1).
    \]
    Let $\ell^{n_1'},\dots,\ell^{n_g'}$ be the invariant factors of $A'$, and let $S$ denote a set of representatives $\beta \in \sO_K$ of the solutions to the equation
    \[
      \left(\gamma^{n_1 + \cdots + n_g}\right)^g \equiv \beta^g\left(\gamma^{n_1' + \cdots + n_g'}\right)^g
      \text{ in } \Gt_{q_1}.
    \]
    Note that $\#S = g$ because $g$ divides $q_1 + 1$, the order of $\Gt_{q_1}$. For any $\beta \in S$, let $y_\beta = (E/\beta(\sC_1),\alpha_{\beta(\sC_1),m})$. By Proposition~\ref{prop:psimod-weakly-isomorphic-to-product}, $\psi_{A'}(y_\beta) = E/\gamma^{gn_1'}(\beta(\sC_1)) \times \cdots \times E/\gamma^{gn_g'}(\beta(\sC_1))$. Therefore $\psi_A(x_1) \approx \psi_{A'}(y_\beta)$ by Lemma~\ref{lem:prod-equiv-torsor}. Moreover, by Lemma~\ref{lem:c-subgps-distinct-quotients} the $y_\beta$ are distinct. Hence we have found $g$ points $y \in Y_0(\ell^m)$ with $\psi_{A}(x_1) \approx \psi_{A'}(y)$.

  For $x_2$, we use a similar construction. By the Chinese remainder theorem, the set of subgroups of $E$ of order $q_1q_2$ is a torsor over $\Gt_{q_1} \times \Gt_{q_2}$. Finding $\beta$ such that
  \[
    \psi_{A}(x_2) \approx \psi_{A'}\left(E/\beta(\sC_1+\sC_2),\alpha_{\beta(\sC_1+\sC_2),m}\right)
  \]
  reduces to finding solutions $\beta$ to the equation
  \[
    \left(\gamma^{n_1 + \cdots + n_g}\right)^g \equiv \beta^g\left(\gamma^{n_1' + \cdots + n_g'}\right)^g
    \text{ in } \Gt_{q_1} \times \Gt_{q_2}.
  \]
  Here $\gamma$ is chosen such that $\alpha \equiv \gamma^g \mod{q_1q_2\sO_K}$. There are precisely $g^2$ solutions $\beta$ to this equation. Continuing this construction for $i=3,4,\dots$, we find that for $x_i$ there are $g^i$ points $y \in Y_0(\ell^m)$ such that $\psi_{A}(x_i) \approx \psi_{A'}(y)$.
\end{proof}

\textcolor{red}{TODO: introduce proof}

\begin{proof}[Proof of Theorem~\ref{thm:curves-dense}]
  Let $S$ denote the Zariski closure of $\sg \cap (X_A \times X_{A'})$ \textcolor{red}{TODO: should this be $\sg(F)$ for some alg. closed field $F$?}. By Lemma~\ref{lem:lim-degree}, $\sg \cap (X_A \times X_{A'})$ has an infinite number of geometric points. This implies that $\dim S \geq 1$. Suppose the dimension equals $1$, so that $S$ is a finite union of curves $V = \cup V_i$. The $V_i$ cannot all be horizontal components---that is, of the form $X \times \{z\}$---since this would contradict Lemma~\ref{lem:lim-degree}. Let $V'$ be $V$ with the horizontal components removed. Consider the projection $\pi_X: V' \to X$. Lemma~\ref{lem:lim-degree} implies that this map has unbounded degree. But $\pi_X$ on each irreducible component of $V'$ is nonconstant, and so $\pi_X|_{V'}$ has finite degree, yielding a contradiction. Therefore $\dim S \geq 2$, whence the claim follows.
\end{proof}







\section{Characteristic $p$}
\label{sec:characteristic-p}

Let $A$ be a $g \times g$ diagonal matrix whose diagonal entries are positive integers, and having determinant $N$. Observe that the map $\psimod: Y_0(N) \to \ag$ factors through $\ao^g$, where we consider elements of $\ao^g$ to be products of $g$ elliptic curves with the product polarization. Write $\psidiag: Y_0(N) \to \ao^g$ for the associated morphism. Thus, if the diagonal entries of $A$ are $d_1, \ldots, d_g$ and for $(E, C) \in Y_0(N)$, we define $E_i$ to be $E/(N/d_i)C$, then
\[
  \psidiag(E,C) = E_1 \times \cdots \times E_g.
\]

\begin{theorem}
  With notation as above,  $\bigcup_A \im\psidiag$ is dense in $\ao^g$.
\end{theorem}

\begin{proof}
 Let $E_0$ be an ordinary elliptic curve with CM by $\sO_K$ for some quadratic imaginary field $K$. Choose a prime $\ell$ that is inert in $K$ and fix a subgroup $\sC_0$ of $E_0$ of order $\ell$. Let $\pi_0$ denote the quotient map $E_0 \to E_0/\sC_0 =: E_1$. Note that by Kani (give ref), since $\sC_0$ is not a kernel ideal of $E_0$, it follows that $\End E_1 \cong \Z + \ell\sO_K$.

 For $i \ge 1$, let $\sC_i$ be any subgroup of $E_i$ of order $\ell$ other than $\pi_{i-1}(\sC_{i-1})$, and let $\pi_i$ be the quotient map $E_i \to E_i/\sC_i =: E_{i+1}$. Again, $\End E_{i+1} \cong \Z + \ell^{i+1}\sO_{i}$ by \textcolor{red}{TODO: cite Kani?}.

 For all $n \in \Z_{\ge 1}$, the composition $\pi^{(n)} = \pi_{n-1} \circ \cdots \circ \pi_0$ is a cyclic $\ell^n$-isogeny on $E$ because \textcolor{red}{TODO: there is no backtracking}.

 Let $S = \{E_i\}_{i=0}^\infty$. Let $(E_{n_1},\dots,E_{n_g}) \in S$ and let $A$ be the diagonal matrix with diagonal entries $\ell^{n_1},\dots,\ell^{n_g}$.  Choose any $n > \max\{n_i\}$, and let $\sC = \ker \pi^{(n)}$. Then $(E_0,\pi^{(n)}) \in Y_0(\ell^n)$ and
 \[
   \psidiag(E_0,\sC) = E_{n_1} \times \cdots \times E_{n_g}.
 \]
Thus, $S \subset \bigcup\psidiag(Y_0(\ell^n))$. Since $S$ is an infinite set of non-isomorphic elliptic curves, $S$ is dense in $\ao$. Therefore $S^g$ is dense in $\ao^g$.
\end{proof}

\bibliographystyle{alpha}
\bibliography{./references}

\end{document}
